# 入金出金报表系统使用指南

## 📋 系统概述

本系统包含两个核心报表页面：
1. **入金报表** - 显示所有充值成功的订单（银行卡充值 + 数字货币充值）
2. **出金报表** - 显示所有提现成功的订单（银行卡提现 + 数字货币提现）

## 📁 文件清单

### 入金报表相关文件
- `src/views/modules/order/rujin.vue` - 入金报表主页面
- `入金报表页面配置说明.md` - 详细配置文档
- `test-rujin-page.html` - 测试指南

### 出金报表相关文件
- `src/views/modules/order/chujin.vue` - 出金报表主页面
- `出金报表页面配置说明.md` - 详细配置文档
- `test-chujin-page.html` - 测试指南

### 总结文档
- `入金出金报表系统使用指南.md` - 本文档

## 🚀 快速开始

### 1. 启动开发环境

**重要提示：** 如果您的终端还没有配置Node.js环境，请先执行以下步骤：

#### 方法A：重启终端（推荐）
关闭所有现有的PowerShell/终端窗口，然后打开一个新的终端窗口。

#### 方法B：刷新环境变量
在当前PowerShell中执行：
```powershell
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")
```

#### 启动开发服务器
```powershell
cd D:\Awww\mt5new\template\admin-vue
yarn dev
```

等待服务器启动后，浏览器会自动打开 http://localhost:9528

### 2. 访问报表页面

登录系统后，在浏览器地址栏输入：

- **入金报表**：`http://localhost:9528/#/order/order-rujin`
- **出金报表**：`http://localhost:9528/#/order/order-chujin`

## 📊 功能对比

| 功能 | 入金报表 | 出金报表 |
|-----|---------|---------|
| **路由地址** | order/order-rujin | order/order-chujin |
| **权限标识** | order:rujin:page | order:chujin:page |
| **操作类型** | 充值入账 | 提现出账 |
| **银行卡筛选** | direction = "recharge" | direction = "withdraw" |
| **数字货币接口** | /rechargeOrder/list | /withdraw/list |
| **状态筛选** | 已完成 (state=3, status=1) | 已完成 (state=3, status=1) |

## 🔌 API接口汇总

### 入金报表接口

#### 1. 银行卡充值
- **URL**: `https://jpmx.xyz/apis/bankCardOrder/list`
- **方法**: POST
- **筛选**: `direction === "recharge" && state === "3"`

#### 2. 数字货币充值
- **URL**: `https://jpmx.xyz/apis/rechargeOrder/list`
- **方法**: POST
- **筛选**: `status === 1`

### 出金报表接口

#### 1. 银行卡提现
- **URL**: `https://jpmx.xyz/apis/bankCardOrder/list`
- **方法**: POST
- **筛选**: `direction === "withdraw" && state === "3"`

#### 2. 数字货币提现
- **URL**: `https://jpmx.xyz/apis/withdraw/list`
- **方法**: POST
- **筛选**: `status === 1`

## 🎯 核心功能

### 共同功能
✅ 搜索：按订单号、用户名、用户UID搜索  
✅ 筛选：按入金/出金方式筛选  
✅ 数据整合：自动合并银行卡和数字货币两个接口的数据  
✅ 分页：每页显示10条记录  
✅ 刷新：手动刷新最新数据  
✅ 排序：按创建时间降序显示  

### 入金报表特有功能
- 显示充值币链和币链地址
- 区分银行卡充值和数字货币充值

### 出金报表特有功能
- 显示实名姓名
- 显示提现币链和提现地址
- 显示提现数量和到账数量
- 区分银行卡提现和数字货币提现

## 📋 字段对比

### 共同字段
- 订单号
- 用户名
- 用户UID
- 支付币种
- 到账币种
- 币种单价
- 手续费
- 支付金额
- 备注
- 创建时间
- 审核时间

### 入金报表特有字段
- 入金方式（银行卡充值/数字货币充值）
- 充值币链
- 币链地址

### 出金报表特有字段
- 实名姓名
- 出金方式（银行卡提现/数字货币提现）
- 提现数量
- 到账数量
- 提现币链

## ⚙️ 添加到系统菜单

### 方法1：通过后台配置（推荐）

在后台管理系统的菜单管理中添加以下两个菜单项：

#### 入金报表菜单
- 菜单名称：入金报表
- 路由地址：order/order-rujin
- 权限标识：order:rujin:page
- 父菜单：订单管理 或 报表管理
- 图标：order

#### 出金报表菜单
- 菜单名称：出金报表
- 路由地址：order/order-chujin
- 权限标识：order:chujin:page
- 父菜单：订单管理 或 报表管理
- 图标：order

### 方法2：修改配置文件

在 `src/menu.js` 中添加：

```javascript
{
  menuId: 999,
  parentId: 337, // 根据实际情况修改
  parentName: null,
  name: "入金报表",
  url: "order/order-rujin",
  perms: "order:rujin:page",
  type: 1,
  icon: "order",
  orderNum: 0,
  list: null,
  appType: "1",
},
{
  menuId: 1000,
  parentId: 337, // 根据实际情况修改
  parentName: null,
  name: "出金报表",
  url: "order/order-chujin",
  perms: "order:chujin:page",
  type: 1,
  icon: "order",
  orderNum: 1,
  list: null,
  appType: "1",
}
```

## ⚠️ 注意事项

### 通用注意事项
1. **登录要求**：必须先登录系统，否则API会返回403错误
2. **环境变量**：确保Node.js环境变量已正确配置
3. **服务器状态**：确保开发服务器正在运行（yarn dev）
4. **数据量**：当前使用前端分页，每次获取1000条记录，数据量过大时可能需要优化

### 入金报表注意事项
- 只显示充值成功的订单
- 银行卡充值筛选条件：direction = "recharge" && state = "3"
- 数字货币充值筛选条件：status = 1

### 出金报表注意事项
- 只显示提现成功的订单
- 银行卡提现筛选条件：direction = "withdraw" && state = "3"
- 数字货币提现筛选条件：status = 1
- 数字货币提现接口的字段名可能需要根据实际返回调整

## 🧪 测试清单

### 入金报表测试
- [ ] 页面能正常打开
- [ ] 银行卡充值数据正常显示
- [ ] 数字货币充值数据正常显示
- [ ] 搜索功能正常工作
- [ ] 筛选功能能区分两种充值方式
- [ ] 分页功能正常
- [ ] 刷新功能正常
- [ ] 所有字段数据完整

### 出金报表测试
- [ ] 页面能正常打开
- [ ] 银行卡提现数据正常显示
- [ ] 数字货币提现数据正常显示
- [ ] 实名姓名字段显示正确
- [ ] 搜索功能正常工作
- [ ] 筛选功能能区分两种提现方式
- [ ] 分页功能正常
- [ ] 刷新功能正常
- [ ] 所有字段数据完整

## 🔧 故障排查

### 常见问题

#### 1. Node.js相关错误
**问题**：执行 `yarn dev` 时提示找不到 node.exe

**解决方案**：
```powershell
# 刷新环境变量
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")

# 或者重启终端窗口
```

#### 2. 403错误
**问题**：API请求返回403错误

**原因**：未登录或登录已过期

**解决方案**：重新登录系统

#### 3. 数据不显示
**问题**：页面打开但没有数据

**排查步骤**：
1. 打开浏览器开发者工具（F12）
2. 查看Console是否有错误信息
3. 查看Network标签页，检查API请求是否成功
4. 查看API返回的数据格式是否正确

#### 4. 某些字段显示为空
**问题**：部分字段显示空白

**原因**：API返回的字段名与代码中映射的字段名不匹配

**解决方案**：
- 检查API实际返回的字段名
- 修改对应Vue文件中 `mergeAndFormatData` 方法的字段映射
- 特别是数字货币提现接口，字段名可能需要调整

#### 5. 页面无法访问
**问题**：输入URL后页面404

**解决方案**：
- 检查路由配置是否正确
- 确认文件路径是否正确
- 如果使用菜单访问，确认菜单已配置

## 📚 技术架构

### 前端框架
- Vue 2.6.14
- Element UI 2.15.7
- Avue 2.8.27

### 核心技术点
1. **数据整合**：使用 Promise.all 并行请求两个接口
2. **字段映射**：灵活映射不同接口的字段名
3. **前端分页**：先获取所有数据再在前端分页
4. **搜索过滤**：支持多字段模糊搜索
5. **类型筛选**：区分不同的充值/提现方式

### 代码结构
```
methods: {
  getDataList()           // 获取数据列表主方法
  getBankCardOrders()     // 获取银行卡订单
  getCryptoOrders()       // 获取数字货币订单
  mergeAndFormatData()    // 合并和格式化数据
  applySearchFilter()     // 应用搜索过滤
  searchChange()          // 搜索条件变化
  refreshChange()         // 刷新事件
  handleRefresh()         // 手动刷新
}
```

## 🎨 UI设计说明

### 表格布局
- 序号列：自动编号
- 搜索栏：置顶，支持多条件搜索
- 操作栏：刷新按钮
- 分页栏：底部居中

### 颜色方案
- 入金报表：蓝色主题 (#409EFF)
- 出金报表：红色主题 (#F56C6C)

### 字段宽度
- 订单号：180px
- 用户名/UID：100-120px
- 币种相关：100px
- 金额相关：120px
- 地址相关：200px（超出显示省略号）
- 备注：150px（超出显示省略号）
- 时间：160px

## 📈 性能优化建议

### 当前实现
- 使用前端分页
- 每次获取1000条记录
- 数据在前端过滤和排序

### 优化方向
1. **后端分页**：数据量大时改为后端分页
2. **虚拟滚动**：使用虚拟滚动技术优化大列表渲染
3. **缓存策略**：缓存已加载的数据，减少重复请求
4. **懒加载**：按需加载数据
5. **防抖节流**：搜索输入添加防抖

## 🔐 权限配置

### 入金报表权限
- 查看权限：`order:rujin:page`
- 建议角色：管理员、财务

### 出金报表权限
- 查看权限：`order:chujin:page`
- 建议角色：管理员、财务

## 📖 相关文档

- [入金报表详细配置](入金报表页面配置说明.md)
- [出金报表详细配置](出金报表页面配置说明.md)
- [入金报表测试指南](test-rujin-page.html)
- [出金报表测试指南](test-chujin-page.html)

## 🎓 开发团队支持

如需修改或扩展功能，请参考以下关键代码位置：

### 修改表格列
在 `tableOption.column` 数组中添加或修改列定义

### 修改API接口
在 `getBankCardOrders` 和 `getCryptoOrders` 方法中修改

### 修改字段映射
在 `mergeAndFormatData` 方法中调整字段映射关系

### 修改搜索逻辑
在 `applySearchFilter` 方法中调整过滤条件

## ✅ 完成清单

- [x] 创建入金报表页面 (rujin.vue)
- [x] 创建出金报表页面 (chujin.vue)
- [x] 整合银行卡充值/提现接口
- [x] 整合数字货币充值/提现接口
- [x] 实现搜索功能
- [x] 实现筛选功能
- [x] 实现分页功能
- [x] 实现刷新功能
- [x] 创建配置文档
- [x] 创建测试指南
- [x] 创建总结文档

---

**开发完成日期**：2025年1月

**版本**：v1.0.0

**技术支持**：如有问题请查看详细配置文档或联系开发团队

