# 行情数据接口文档（前端对接版）

## 文档说明

本文档为行情数据接口的前端对接文档，所有接口均已集成AllTick数据源，但对前端完全透明，无需任何修改。

**版本**: v2.0
**更新日期**: 2025-01-20
**基础URL**: `http://localhost:8090`

---

## 一、K线数据接口

### 1.1 接口信息

**接口地址**: `/api/hobi!getKline.action`
**请求方式**: `GET`
**接口说明**: 获取指定币种的K线数据（支持多种周期）

### 1.2 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| symbol | String | 是 | 币种代码 | AAPL, BTCUSDT, 00700, SH600519 |
| line | String | 是 | K线周期 | 1min, 5min, 1day, 1week, 1mon |

**支持的K线周期：**
- `1min` - 1分钟K线
- `5min` - 5分钟K线
- `15min` - 15分钟K线
- `30min` - 30分钟K线
- `60min` - 60分钟K线
- `1day` / `1d` - 日K线
- `1week` / `1w` - 周K线
- `1mon` / `1m` - 月K线
- `1quarter` - 季K线
- `1year` - 年K线

### 1.3 请求示例

```bash
# 获取苹果股票日K线
GET /api/hobi!getKline.action?symbol=AAPL&line=1day

# 获取比特币1小时K线
GET /api/hobi!getKline.action?symbol=BTCUSDT&line=60min

# 获取腾讯港股日K线
GET /api/hobi!getKline.action?symbol=00700&line=1day

# 获取茅台A股周K线
GET /api/hobi!getKline.action?symbol=SH600519&line=1week
```

### 1.4 响应参数

**成功响应示例：**
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "ts": 1705651200000,
      "open": 185.23,
      "high": 187.45,
      "low": 184.50,
      "close": 186.78,
      "volume": 52300000,
      "amount": 0
    },
    {
      "ts": 1705564800000,
      "open": 184.12,
      "high": 185.89,
      "low": 183.45,
      "close": 185.23,
      "volume": 48900000,
      "amount": 0
    }
  ]
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| code | Integer | 状态码 | 0=成功，非0=失败 |
| msg | String | 返回消息 | 成功时为"success" |
| data | Array | K线数据数组 | 按时间倒序排列 |
| data[].ts | Long | 时间戳 | 毫秒级Unix时间戳 |
| data[].open | Double | 开盘价 | 精度根据币种类型调整 |
| data[].high | Double | 最高价 | 精度根据币种类型调整 |
| data[].low | Double | 最低价 | 精度根据币种类型调整 |
| data[].close | Double | 收盘价 | 精度根据币种类型调整 |
| data[].volume | Double | 成交量 | - |
| data[].amount | Double | 成交额 | 部分数据源不提供，默认为0 |

### 1.5 错误响应

```json
{
  "code": 500,
  "msg": "k线图获取失败",
  "data": null
}
```

### 1.6 前端调用示例

**JavaScript (Axios):**
```javascript
// 获取K线数据
async function getKlineData(symbol, period) {
  try {
    const response = await axios.get('/api/hobi!getKline.action', {
      params: {
        symbol: symbol,
        line: period
      }
    });

    if (response.data.code === 0) {
      return response.data.data;
    } else {
      console.error('获取K线数据失败:', response.data.msg);
      return [];
    }
  } catch (error) {
    console.error('请求失败:', error);
    return [];
  }
}

// 使用示例
const klineData = await getKlineData('AAPL', '1day');
console.log('K线数据:', klineData);
```

**jQuery:**
```javascript
$.ajax({
  url: '/api/hobi!getKline.action',
  method: 'GET',
  data: {
    symbol: 'AAPL',
    line: '1day'
  },
  success: function(response) {
    if (response.code === 0) {
      console.log('K线数据:', response.data);
      // 处理数据，绘制图表
      renderChart(response.data);
    }
  },
  error: function(error) {
    console.error('请求失败:', error);
  }
});
```

---

## 二、实时行情接口

### 2.1 接口信息

**接口地址**: `/api/hobi!getRealtime.action`
**请求方式**: `GET`
**接口说明**: 获取指定币种的实时行情数据

### 2.2 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| symbol | String | 是 | 币种代码 | AAPL, BTCUSDT, 00700 |

### 2.3 请求示例

```bash
# 获取苹果股票实时行情
GET /api/hobi!getRealtime.action?symbol=AAPL

# 获取比特币实时行情
GET /api/hobi!getRealtime.action?symbol=BTCUSDT

# 获取腾讯实时行情
GET /api/hobi!getRealtime.action?symbol=00700
```

### 2.4 响应参数

**成功响应示例：**
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "symbol": "AAPL",
      "type": "US-stocks",
      "name": "苹果",
      "symbolData": "AAPL",
      "ts": 1705651234567,
      "open": 185.23,
      "high": 187.45,
      "low": 184.50,
      "close": 186.78,
      "volume": 52300000,
      "amount": 9765432100,
      "netChange": 1.55,
      "changeRatio": 0.84,
      "chg": "+0.84%",
      "ask": 186.79,
      "bid": 186.77
    }
  ]
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| code | Integer | 状态码 | 0=成功，非0=失败 |
| msg | String | 返回消息 | 成功时为"success" |
| data | Array | 实时行情数组 | 通常只有1条数据 |
| symbol | String | 币种代码 | 与请求参数一致 |
| type | String | 币种类型 | US-stocks, HK-stocks, A-stocks, cryptos, forex等 |
| name | String | 币种名称 | 中文名称 |
| symbolData | String | 币种数据代码 | 用于数据查询的标准代码 |
| ts | Long | 时间戳 | 毫秒级Unix时间戳 |
| open | Double | 开盘价 | 当日开盘价 |
| high | Double | 最高价 | 当日最高价 |
| low | Double | 最低价 | 当日最低价 |
| close | Double | 最新价 | 当前最新价格 |
| volume | Double | 成交量 | 当日累计成交量 |
| amount | Double | 成交额 | 当日累计成交额 |
| netChange | Double | 涨跌额 | close - open |
| changeRatio | Double | 涨跌幅 | (netChange / open) * 100 |
| chg | String | 涨跌幅字符串 | 带正负号和百分号，如"+0.84%" |
| ask | Double | 卖一价 | 当前卖出价格 |
| bid | Double | 买一价 | 当前买入价格 |

### 2.5 错误响应

```json
{
  "code": 500,
  "msg": "生成实时数据失败",
  "data": null
}
```

### 2.6 前端调用示例

**JavaScript (Axios):**
```javascript
// 获取实时行情
async function getRealtimeData(symbol) {
  try {
    const response = await axios.get('/api/hobi!getRealtime.action', {
      params: { symbol: symbol }
    });

    if (response.data.code === 0 && response.data.data.length > 0) {
      const realtime = response.data.data[0];
      return {
        price: realtime.close,
        change: realtime.netChange,
        changePercent: realtime.changeRatio,
        volume: realtime.volume
      };
    }
    return null;
  } catch (error) {
    console.error('获取实时行情失败:', error);
    return null;
  }
}

// 使用示例 - 实时更新价格
setInterval(async () => {
  const data = await getRealtimeData('AAPL');
  if (data) {
    document.getElementById('price').textContent = data.price.toFixed(2);
    document.getElementById('change').textContent = data.change.toFixed(2);
    document.getElementById('changePercent').textContent = data.changePercent.toFixed(2) + '%';
  }
}, 3000); // 每3秒更新一次
```

**Vue.js 示例:**
```vue
<template>
  <div class="realtime-panel">
    <div class="symbol-name">{{ realtimeData.name }}</div>
    <div class="price" :class="priceClass">{{ realtimeData.close }}</div>
    <div class="change">
      <span>{{ realtimeData.netChange }}</span>
      <span>{{ realtimeData.chg }}</span>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      realtimeData: {},
      timer: null
    }
  },
  computed: {
    priceClass() {
      if (this.realtimeData.netChange > 0) return 'price-up';
      if (this.realtimeData.netChange < 0) return 'price-down';
      return '';
    }
  },
  mounted() {
    this.loadRealtimeData();
    this.timer = setInterval(this.loadRealtimeData, 3000);
  },
  beforeUnmount() {
    if (this.timer) clearInterval(this.timer);
  },
  methods: {
    async loadRealtimeData() {
      const response = await this.$http.get('/api/hobi!getRealtime.action', {
        params: { symbol: this.symbol }
      });
      if (response.data.code === 0) {
        this.realtimeData = response.data.data[0];
      }
    }
  }
}
</script>
```

---

## 三、市场深度接口

### 3.1 接口信息

**接口地址**: `/api/hobi!getDepth.action`
**请求方式**: `GET` / `POST`
**接口说明**: 获取指定币种的市场深度（盘口）数据

### 3.2 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| symbol | String | 是 | 币种代码 | AAPL, BTCUSDT, 00700 |

### 3.3 请求示例

```bash
# 获取苹果股票市场深度
GET /api/hobi!getDepth.action?symbol=AAPL

# 获取比特币市场深度
GET /api/hobi!getDepth.action?symbol=BTCUSDT
```

### 3.4 响应参数

**成功响应示例：**
```json
{
  "code": "200",
  "msg": "success",
  "data": {
    "asks": [
      {"price": "186.79", "amount": "1500"},
      {"price": "186.80", "amount": "2300"},
      {"price": "186.81", "amount": "1800"},
      {"price": "186.82", "amount": "2100"},
      {"price": "186.83", "amount": "1600"}
    ],
    "bids": [
      {"price": "186.77", "amount": "2000"},
      {"price": "186.76", "amount": "1900"},
      {"price": "186.75", "amount": "2500"},
      {"price": "186.74", "amount": "1700"},
      {"price": "186.73", "amount": "2200"}
    ]
  }
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| code | String | 状态码 | "200"=成功 |
| msg | String | 返回消息 | 成功时为"success" |
| data | Object | 市场深度数据 | - |
| data.asks | Array | 卖盘数据 | 按价格从低到高排序 |
| data.bids | Array | 买盘数据 | 按价格从高到低排序 |
| asks[].price | String | 卖出价格 | 字符串格式，保留小数 |
| asks[].amount | String | 卖出数量 | 字符串格式 |
| bids[].price | String | 买入价格 | 字符串格式，保留小数 |
| bids[].amount | String | 买入数量 | 字符串格式 |

**注意事项：**
1. 返回的价格和数量都是字符串格式，已格式化为指定精度
2. asks数组按价格从低到高排序（卖1在最前）
3. bids数组按价格从高到低排序（买1在最前）
4. 默认返回20档深度数据（可能少于20档）

### 3.5 错误响应

```json
{
  "code": "400",
  "msg": "[symbol]参数为空",
  "data": null
}
```

```json
{
  "code": "402",
  "msg": "获取深度数据失败",
  "data": null
}
```

### 3.6 前端调用示例

**JavaScript (原生):**
```javascript
// 获取市场深度
async function getDepthData(symbol) {
  try {
    const response = await fetch(`/api/hobi!getDepth.action?symbol=${symbol}`);
    const data = await response.json();

    if (data.code === "200") {
      return data.data;
    }
    return null;
  } catch (error) {
    console.error('获取市场深度失败:', error);
    return null;
  }
}

// 渲染深度数据到表格
function renderDepthTable(depthData) {
  if (!depthData) return;

  // 渲染卖盘（红色，倒序显示）
  const asksHtml = depthData.asks.reverse().map((ask, index) => `
    <tr class="ask-row">
      <td class="price-cell red">${ask.price}</td>
      <td class="amount-cell">${ask.amount}</td>
      <td class="level-cell">卖${depthData.asks.length - index}</td>
    </tr>
  `).join('');

  // 渲染买盘（绿色）
  const bidsHtml = depthData.bids.map((bid, index) => `
    <tr class="bid-row">
      <td class="price-cell green">${bid.price}</td>
      <td class="amount-cell">${bid.amount}</td>
      <td class="level-cell">买${index + 1}</td>
    </tr>
  `).join('');

  document.getElementById('depth-table').innerHTML = asksHtml + bidsHtml;
}

// 使用示例 - 实时更新深度
setInterval(async () => {
  const depth = await getDepthData('AAPL');
  if (depth) {
    renderDepthTable(depth);
  }
}, 5000); // 每5秒更新一次
```

**React 示例:**
```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

function DepthPanel({ symbol }) {
  const [depthData, setDepthData] = useState({ asks: [], bids: [] });

  useEffect(() => {
    const loadDepth = async () => {
      try {
        const response = await axios.get('/api/hobi!getDepth.action', {
          params: { symbol }
        });
        if (response.data.code === "200") {
          setDepthData(response.data.data);
        }
      } catch (error) {
        console.error('获取深度数据失败:', error);
      }
    };

    loadDepth();
    const timer = setInterval(loadDepth, 5000);
    return () => clearInterval(timer);
  }, [symbol]);

  return (
    <div className="depth-panel">
      <h3>市场深度</h3>
      <table className="depth-table">
        <thead>
          <tr>
            <th>价格</th>
            <th>数量</th>
            <th>档位</th>
          </tr>
        </thead>
        <tbody>
          {/* 卖盘 - 倒序显示 */}
          {depthData.asks.slice().reverse().map((ask, index) => (
            <tr key={`ask-${index}`} className="ask-row">
              <td className="price red">{ask.price}</td>
              <td className="amount">{ask.amount}</td>
              <td className="level">卖{depthData.asks.length - index}</td>
            </tr>
          ))}

          {/* 分隔线 */}
          <tr className="separator">
            <td colSpan="3">───────────</td>
          </tr>

          {/* 买盘 */}
          {depthData.bids.map((bid, index) => (
            <tr key={`bid-${index}`} className="bid-row">
              <td className="price green">{bid.price}</td>
              <td className="amount">{bid.amount}</td>
              <td className="level">买{index + 1}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

export default DepthPanel;
```

---

## 四、通用说明

### 4.1 支持的币种类型

| 类型代码 | 说明 | 代码示例 |
|---------|------|---------|
| US-stocks | 美股 | AAPL, TSLA, MSFT, GOOGL |
| HK-stocks | 港股 | 00700（腾讯）, 09988（阿里）, 01810（小米） |
| A-stocks | A股 | SH600519（茅台）, SZ000001（平安） |
| cryptos | 加密货币 | BTCUSDT, ETHUSDT, BNBUSDT |
| forex | 外汇 | EURUSD, GBPUSD, USDJPY |
| indices | 指数 | HKHSI（恒生指数）, SPX（标普500） |

### 4.2 币种代码格式

**美股：** 直接使用股票代码
- `AAPL` - 苹果
- `TSLA` - 特斯拉
- `MSFT` - 微软

**港股：** 使用5位数字代码
- `00700` - 腾讯控股
- `09988` - 阿里巴巴
- `01810` - 小米集团

**A股：** 使用交易所前缀+代码
- `SH600519` - 贵州茅台（沪市）
- `SZ000001` - 平安银行（深市）
- `SH000001` - 上证指数

**加密货币：** 使用交易对
- `BTCUSDT` - 比特币/USDT
- `ETHUSDT` - 以太坊/USDT

**外汇：** 使用货币对
- `EURUSD` - 欧元/美元
- `GBPUSD` - 英镑/美元

### 4.3 数据精度说明

不同类型的币种使用不同的价格精度：

| 币种类型 | 价格精度 | 示例 |
|---------|---------|------|
| 美股 | 2位小数 | 186.78 |
| 港股 | 2位小数 | 357.40 |
| A股 | 2位小数 | 1689.99 |
| 加密货币 | 2-8位小数 | 43256.78（BTC），0.00001234（小币种） |
| 外汇 | 4-5位小数 | 1.0856 |

### 4.4 时间戳说明

所有接口返回的时间戳均为**毫秒级Unix时间戳**。

**JavaScript转换示例：**
```javascript
// 时间戳转日期
const date = new Date(1705651234567);
console.log(date.toLocaleString()); // "2025-01-19 15:20:34"

// 格式化为指定格式
function formatTimestamp(timestamp) {
  const date = new Date(timestamp);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  const seconds = String(date.getSeconds()).padStart(2, '0');

  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
}

console.log(formatTimestamp(1705651234567)); // "2025-01-19 15:20:34"
```

### 4.5 跨域配置

所有接口已配置CORS跨域支持，前端可直接调用。

**支持的请求头：**
- `Content-Type: application/json`
- `Content-Type: application/x-www-form-urlencoded`

**支持的请求方法：**
- `GET`
- `POST`
- `OPTIONS`

### 4.6 错误处理建议

```javascript
// 统一错误处理函数
function handleApiError(error, defaultMessage = '操作失败') {
  if (error.response) {
    // 服务器返回错误
    const code = error.response.data.code;
    const msg = error.response.data.msg;

    switch(code) {
      case 400:
        console.error('参数错误:', msg);
        break;
      case 401:
        console.error('未授权，请先登录');
        // 跳转到登录页
        break;
      case 500:
        console.error('服务器错误:', msg);
        break;
      default:
        console.error(msg || defaultMessage);
    }
  } else if (error.request) {
    // 请求已发送但没有收到响应
    console.error('网络错误，请检查网络连接');
  } else {
    // 请求配置错误
    console.error('请求失败:', error.message);
  }
}

// 使用示例
try {
  const response = await axios.get('/api/hobi!getKline.action', {
    params: { symbol: 'AAPL', line: '1day' }
  });
  // 处理响应
} catch (error) {
  handleApiError(error, '获取K线数据失败');
}
```

---

## 五、完整示例项目

### 5.1 股票行情看板（完整示例）

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>股票行情看板</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .symbol-input {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 200px;
    }
    .realtime-panel {
      background: #fafafa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .price {
      font-size: 48px;
      font-weight: bold;
      margin: 10px 0;
    }
    .price-up { color: #e74c3c; }
    .price-down { color: #27ae60; }
    .change {
      font-size: 24px;
      margin: 10px 0;
    }
    .chart-container {
      height: 400px;
      margin-bottom: 20px;
    }
    .depth-table {
      width: 100%;
      border-collapse: collapse;
    }
    .depth-table th,
    .depth-table td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    .depth-table th {
      background: #f5f5f5;
      font-weight: bold;
    }
    .ask-row { background: #ffebee; }
    .bid-row { background: #e8f5e9; }
    .red { color: #e74c3c; }
    .green { color: #27ae60; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>股票行情看板</h1>
      <input type="text" class="symbol-input" id="symbolInput"
             placeholder="输入股票代码" value="AAPL">
    </div>

    <!-- 实时行情 -->
    <div class="realtime-panel" id="realtimePanel">
      <h2 id="symbolName">加载中...</h2>
      <div class="price" id="price">--</div>
      <div class="change">
        <span id="netChange">--</span>
        <span id="changePercent">--</span>
      </div>
      <div>
        开盘: <span id="open">--</span> |
        最高: <span id="high">--</span> |
        最低: <span id="low">--</span> |
        成交量: <span id="volume">--</span>
      </div>
    </div>

    <!-- K线图 -->
    <div class="chart-container" id="chartContainer"></div>

    <!-- 市场深度 -->
    <h3>市场深度</h3>
    <table class="depth-table" id="depthTable">
      <thead>
        <tr>
          <th>价格</th>
          <th>数量</th>
          <th>档位</th>
        </tr>
      </thead>
      <tbody id="depthBody">
        <tr><td colspan="3">加载中...</td></tr>
      </tbody>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script>
    let currentSymbol = 'AAPL';
    let chart = null;

    // 初始化图表
    function initChart() {
      chart = echarts.init(document.getElementById('chartContainer'));
    }

    // 获取实时行情
    async function loadRealtime() {
      try {
        const response = await axios.get('/api/hobi!getRealtime.action', {
          params: { symbol: currentSymbol }
        });

        if (response.data.code === 0 && response.data.data.length > 0) {
          const data = response.data.data[0];

          document.getElementById('symbolName').textContent = data.name + ' (' + data.symbol + ')';
          document.getElementById('price').textContent = data.close.toFixed(2);
          document.getElementById('netChange').textContent =
            (data.netChange >= 0 ? '+' : '') + data.netChange.toFixed(2);
          document.getElementById('changePercent').textContent = data.chg;
          document.getElementById('open').textContent = data.open.toFixed(2);
          document.getElementById('high').textContent = data.high.toFixed(2);
          document.getElementById('low').textContent = data.low.toFixed(2);
          document.getElementById('volume').textContent =
            (data.volume / 1000000).toFixed(2) + 'M';

          // 设置价格颜色
          const priceEl = document.getElementById('price');
          priceEl.className = 'price ' + (data.netChange >= 0 ? 'price-up' : 'price-down');
        }
      } catch (error) {
        console.error('获取实时行情失败:', error);
      }
    }

    // 获取K线数据
    async function loadKline() {
      try {
        const response = await axios.get('/api/hobi!getKline.action', {
          params: {
            symbol: currentSymbol,
            line: '1day'
          }
        });

        if (response.data.code === 0) {
          const data = response.data.data;

          // 准备图表数据
          const dates = data.map(item => {
            const date = new Date(item.ts);
            return `${date.getMonth()+1}/${date.getDate()}`;
          }).reverse();

          const klineData = data.map(item => [
            item.open,
            item.close,
            item.low,
            item.high
          ]).reverse();

          // 渲染K线图
          chart.setOption({
            title: { text: 'K线图' },
            tooltip: { trigger: 'axis' },
            xAxis: {
              type: 'category',
              data: dates
            },
            yAxis: {
              type: 'value',
              scale: true
            },
            series: [{
              type: 'candlestick',
              data: klineData,
              itemStyle: {
                color: '#e74c3c',
                color0: '#27ae60',
                borderColor: '#e74c3c',
                borderColor0: '#27ae60'
              }
            }]
          });
        }
      } catch (error) {
        console.error('获取K线数据失败:', error);
      }
    }

    // 获取市场深度
    async function loadDepth() {
      try {
        const response = await axios.get('/api/hobi!getDepth.action', {
          params: { symbol: currentSymbol }
        });

        if (response.data.code === "200") {
          const data = response.data.data;
          let html = '';

          // 卖盘（倒序）
          data.asks.slice().reverse().forEach((ask, index) => {
            html += `
              <tr class="ask-row">
                <td class="red">${ask.price}</td>
                <td>${ask.amount}</td>
                <td>卖${data.asks.length - index}</td>
              </tr>
            `;
          });

          // 分隔线
          html += '<tr><td colspan="3">───────────</td></tr>';

          // 买盘
          data.bids.forEach((bid, index) => {
            html += `
              <tr class="bid-row">
                <td class="green">${bid.price}</td>
                <td>${bid.amount}</td>
                <td>买${index + 1}</td>
              </tr>
            `;
          });

          document.getElementById('depthBody').innerHTML = html;
        }
      } catch (error) {
        console.error('获取市场深度失败:', error);
      }
    }

    // 切换股票
    document.getElementById('symbolInput').addEventListener('change', function(e) {
      currentSymbol = e.target.value.trim();
      loadAll();
    });

    // 加载所有数据
    function loadAll() {
      loadRealtime();
      loadKline();
      loadDepth();
    }

    // 初始化
    initChart();
    loadAll();

    // 定时刷新（实时行情3秒，深度5秒）
    setInterval(loadRealtime, 3000);
    setInterval(loadDepth, 5000);
  </script>
</body>
</html>
```

---

## 六、更新日志

### v2.0 (2025-01-20)
- ✅ 集成AllTick数据源
- ✅ 添加自动降级机制
- ✅ 保持所有接口格式不变
- ✅ 对前端完全透明，无需任何修改

### v1.0 (2024-12-01)
- 初始版本
- 提供K线、实时行情、市场深度三个接口

---

## 七、技术支持

**联系方式**: support@example.com
**在线文档**: https://docs.example.com
**技术支持热线**: 400-XXX-XXXX

---

**文档版本**: v2.0
**更新日期**: 2025-01-20
**维护团队**: 系统开发团队
