<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•è‹±æ–‡é»˜è®¤è¯­è¨€è®¾ç½®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.3);
            border: 2px solid #FFC107;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #F44336;
        }
        
        .info {
            background: rgba(33, 150, 243, 0.3);
            border: 2px solid #2196F3;
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-results {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        .current-status {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .actions {
            text-align: center;
            margin: 20px 0;
        }
        
        .debug-info {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ è‹±æ–‡é»˜è®¤è¯­è¨€è®¾ç½®æµ‹è¯•</h1>
        
        <div id="current-status" class="current-status"></div>
        
        <div class="actions">
            <button onclick="checkCurrentStatus()">ğŸ” æ£€æŸ¥å½“å‰çŠ¶æ€</button>
            <button onclick="clearLanguageSettings()">ğŸ—‘ï¸ æ¸…é™¤è¯­è¨€è®¾ç½®</button>
            <button onclick="forceEnglishLanguage()">ğŸ‡ºğŸ‡¸ å¼ºåˆ¶è®¾ç½®è‹±æ–‡</button>
            <button onclick="testLanguageInitialization()">ğŸ§ª æµ‹è¯•è¯­è¨€åˆå§‹åŒ–</button>
            <button onclick="openH5App()">ğŸš€ æ‰“å¼€H5åº”ç”¨</button>
        </div>
        
        <div class="debug-info" id="debug-info"></div>
        
        <div class="test-results" id="test-results">
            <h3>ğŸ“‹ æµ‹è¯•ç»“æœ</h3>
            <div id="results-content">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>
    </div>

    <script>
        // æ›´æ–°å½“å‰çŠ¶æ€æ˜¾ç¤º
        function updateCurrentStatus() {
            const statusDiv = document.getElementById('current-status');
            const storedLang = localStorage.getItem('lang');
            
            if (storedLang === 'en-US') {
                statusDiv.className = 'current-status success';
                statusDiv.innerHTML = `âœ… å½“å‰è¯­è¨€è®¾ç½®: ${storedLang} (è‹±æ–‡)`;
            } else if (storedLang === 'zh-CN' || storedLang === 'zh-TW' || storedLang === 'zh') {
                statusDiv.className = 'current-status warning';
                statusDiv.innerHTML = `âš ï¸ å½“å‰è¯­è¨€è®¾ç½®: ${storedLang} (ä¸­æ–‡)`;
            } else if (!storedLang) {
                statusDiv.className = 'current-status info';
                statusDiv.innerHTML = `â„¹ï¸ å½“å‰è¯­è¨€è®¾ç½®: æœªè®¾ç½®`;
            } else {
                statusDiv.className = 'current-status info';
                statusDiv.innerHTML = `â„¹ï¸ å½“å‰è¯­è¨€è®¾ç½®: ${storedLang}`;
            }
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            updateDebugInfo();
        }
        
        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            const debugDiv = document.getElementById('debug-info');
            const storedLang = localStorage.getItem('lang');
            
            const debugInfo = `
<strong>ğŸ” è°ƒè¯•ä¿¡æ¯</strong><br>
<strong>localStorage['lang']:</strong> ${storedLang || 'null'}<br>
<strong>æµè§ˆå™¨è¯­è¨€:</strong> ${navigator.language}<br>
<strong>å½“å‰åŸŸå:</strong> ${window.location.hostname}<br>
<strong>å½“å‰è·¯å¾„:</strong> ${window.location.pathname}<br>
<strong>å½“å‰æ—¶é—´:</strong> ${new Date().toLocaleString()}<br>
<strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent.substring(0, 100)}...
            `;
            debugDiv.innerHTML = debugInfo;
        }
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message, type = 'info') {
            const resultsContent = document.getElementById('results-content');
            const timestamp = new Date().toLocaleTimeString();
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = `[${timestamp}] ${message}`;
            
            if (resultsContent.innerHTML === 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...') {
                resultsContent.innerHTML = '';
            }
            
            resultsContent.appendChild(resultDiv);
            resultsContent.scrollTop = resultsContent.scrollHeight;
        }
        
        // æ£€æŸ¥å½“å‰çŠ¶æ€
        function checkCurrentStatus() {
            updateCurrentStatus();
            const storedLang = localStorage.getItem('lang');
            
            if (storedLang === 'en-US') {
                addTestResult('âœ… è¯­è¨€è®¾ç½®æ­£ç¡®: en-US (è‹±æ–‡)', 'success');
            } else if (storedLang === 'zh-CN' || storedLang === 'zh-TW' || storedLang === 'zh') {
                addTestResult(`âš ï¸ æ£€æµ‹åˆ°ä¸­æ–‡è¯­è¨€è®¾ç½®: ${storedLang}ï¼Œéœ€è¦ä¿®å¤`, 'warning');
            } else if (!storedLang) {
                addTestResult('â„¹ï¸ æ²¡æœ‰è¯­è¨€è®¾ç½®ï¼Œéœ€è¦åˆå§‹åŒ–ä¸ºè‹±æ–‡', 'info');
            } else {
                addTestResult(`â„¹ï¸ å½“å‰è¯­è¨€è®¾ç½®: ${storedLang}`, 'info');
            }
        }
        
        // æ¸…é™¤è¯­è¨€è®¾ç½®
        function clearLanguageSettings() {
            try {
                const oldLang = localStorage.getItem('lang');
                localStorage.removeItem('lang');
                updateCurrentStatus();
                addTestResult(`ğŸ—‘ï¸ å·²æ¸…é™¤è¯­è¨€è®¾ç½®: ${oldLang || 'null'} â†’ null`, 'info');
            } catch (error) {
                addTestResult(`âŒ æ¸…é™¤è¯­è¨€è®¾ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å¼ºåˆ¶è®¾ç½®è‹±æ–‡è¯­è¨€
        function forceEnglishLanguage() {
            try {
                const oldLang = localStorage.getItem('lang');
                localStorage.setItem('lang', 'en-US');
                updateCurrentStatus();
                addTestResult(`ğŸ‡ºğŸ‡¸ å·²å¼ºåˆ¶è®¾ç½®ä¸ºè‹±æ–‡: ${oldLang || 'null'} â†’ en-US`, 'success');
            } catch (error) {
                addTestResult(`âŒ è®¾ç½®è‹±æ–‡è¯­è¨€å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•è¯­è¨€åˆå§‹åŒ–é€»è¾‘
        function testLanguageInitialization() {
            addTestResult('ğŸ§ª å¼€å§‹æµ‹è¯•è¯­è¨€åˆå§‹åŒ–é€»è¾‘...', 'info');
            
            // 1. æ¸…é™¤è¯­è¨€è®¾ç½®
            localStorage.removeItem('lang');
            addTestResult('1ï¸âƒ£ å·²æ¸…é™¤è¯­è¨€è®¾ç½®', 'info');
            
            // 2. æ¨¡æ‹Ÿåº”ç”¨åˆå§‹åŒ–
            setTimeout(() => {
                const currentLang = localStorage.getItem('lang');
                if (!currentLang) {
                    // æ¨¡æ‹Ÿé»˜è®¤è¯­è¨€è®¾ç½®
                    localStorage.setItem('lang', 'en-US');
                    addTestResult('2ï¸âƒ£ æ¨¡æ‹Ÿåº”ç”¨åˆå§‹åŒ–ï¼Œè®¾ç½®é»˜è®¤è¯­è¨€ä¸ºè‹±æ–‡', 'success');
                } else {
                    addTestResult(`2ï¸âƒ£ è¯­è¨€å·²å­˜åœ¨: ${currentLang}`, 'info');
                }
                
                updateCurrentStatus();
                
                // 3. éªŒè¯ç»“æœ
                setTimeout(() => {
                    const finalLang = localStorage.getItem('lang');
                    if (finalLang === 'en-US') {
                        addTestResult('3ï¸âƒ£ âœ… è¯­è¨€åˆå§‹åŒ–æµ‹è¯•æˆåŠŸ: en-US', 'success');
                    } else {
                        addTestResult(`3ï¸âƒ£ âŒ è¯­è¨€åˆå§‹åŒ–æµ‹è¯•å¤±è´¥: ${finalLang}`, 'error');
                    }
                }, 500);
            }, 500);
        }
        
        // æ‰“å¼€H5åº”ç”¨
        function openH5App() {
            addTestResult('ğŸš€ æ­£åœ¨æ‰“å¼€H5åº”ç”¨...', 'info');
            
            // ç¡®ä¿è¯­è¨€è®¾ç½®ä¸ºè‹±æ–‡
            if (localStorage.getItem('lang') !== 'en-US') {
                localStorage.setItem('lang', 'en-US');
                addTestResult('ğŸ”§ å·²ç¡®ä¿è¯­è¨€è®¾ç½®ä¸ºè‹±æ–‡', 'success');
            }
            
            // æ‰“å¼€H5åº”ç”¨
            const h5Url = window.location.hostname === 'localhost' 
                ? 'http://localhost:3333/h5/' 
                : 'https://jpmx.xyz/h5/';
            
            addTestResult(`ğŸŒ å³å°†è·³è½¬åˆ°: ${h5Url}`, 'info');
            
            setTimeout(() => {
                window.open(h5Url, '_blank');
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateCurrentStatus();
            addTestResult('ğŸ“± è‹±æ–‡é»˜è®¤è¯­è¨€æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            
            // æ£€æŸ¥å½“å‰ç¯å¢ƒ
            const isProduction = window.location.hostname === 'jpmx.xyz';
            const isDevelopment = window.location.hostname === 'localhost';
            
            if (isProduction) {
                addTestResult('ğŸŒ å½“å‰ç¯å¢ƒ: ç”Ÿäº§ç¯å¢ƒ (jpmx.xyz)', 'info');
            } else if (isDevelopment) {
                addTestResult('ğŸ’» å½“å‰ç¯å¢ƒ: å¼€å‘ç¯å¢ƒ (localhost)', 'info');
            } else {
                addTestResult(`ğŸ” å½“å‰ç¯å¢ƒ: ${window.location.hostname}`, 'info');
            }
        });
        
        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(updateCurrentStatus, 2000);
    </script>
</body>
</html>
