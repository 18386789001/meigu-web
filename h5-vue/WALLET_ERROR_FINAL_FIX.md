# H5-Vue é’±åŒ…é”™è¯¯æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æè¿°

h5-vueé¡¹ç›®é¦–é¡µæ‰“å¼€æ—¶å‡ºç°é’±åŒ…æ‰©å±•é”™è¯¯ï¼š
```
Talisman extension has not been configured yet. Please continue with onboarding.
Sender: Failed to get initial state. Please report this bug.
```

## âœ… æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

### 1. å¤šå±‚é”™è¯¯è¿‡æ»¤æœºåˆ¶

#### ç¬¬ä¸€å±‚ï¼šHTMLå†…è”è¿‡æ»¤å™¨ï¼ˆæœ€æ—©æœŸï¼‰
åœ¨ `index.html` ä¸­æ·»åŠ å†…è”è„šæœ¬ï¼Œåœ¨ä»»ä½•å…¶ä»–è„šæœ¬åŠ è½½å‰å°±å¼€å§‹è¿‡æ»¤é’±åŒ…é”™è¯¯ï¼š

```html
<script>
  // ç«‹å³è®¾ç½®é’±åŒ…é”™è¯¯è¿‡æ»¤å™¨
  (function() {
    const isWalletError = (message) => {
      if (!message) return false;
      const msg = message.toLowerCase();
      return msg.includes('talisman') || 
             msg.includes('sender') || 
             msg.includes('polkadot') ||
             msg.includes('wallet') ||
             msg.includes('getproviderstate');
    };
    
    // è¿‡æ»¤Promiseé”™è¯¯ã€JavaScripté”™è¯¯ã€console.error
    // ...
  })();
</script>
```

#### ç¬¬äºŒå±‚ï¼šErrorFilter.jsï¼ˆåº”ç”¨çº§ï¼‰
`src/utils/errorFilter.js` æä¾›å®Œæ•´çš„é”™è¯¯è¿‡æ»¤åŠŸèƒ½ï¼š
- æ™ºèƒ½å…³é”®è¯åŒ¹é…
- ç»Ÿè®¡å’Œè°ƒè¯•åŠŸèƒ½
- å¯æ‰©å±•çš„è¿‡æ»¤è§„åˆ™

#### ç¬¬ä¸‰å±‚ï¼šErrorHandler.jsï¼ˆå…œåº•ï¼‰
`src/utils/errorHandler.js` åœ¨å¤„ç†é”™è¯¯å‰æ£€æŸ¥æ˜¯å¦ä¸ºé’±åŒ…é”™è¯¯ï¼š
- è·³è¿‡é’±åŒ…é”™è¯¯å¤„ç†
- ä¿ç•™æ­£å¸¸é”™è¯¯å¤„ç†æµç¨‹

### 2. ä¿®å¤çš„å…·ä½“é—®é¢˜

#### âœ… Promiseé”™è¯¯è¿‡æ»¤
- ä½¿ç”¨ `addEventListener('unhandledrejection')` æ•è·
- ä½¿ç”¨æ•è·é˜¶æ®µ (`true`) ç¡®ä¿ä¼˜å…ˆå¤„ç†
- è°ƒç”¨ `preventDefault()` å’Œ `stopImmediatePropagation()`

#### âœ… JavaScripté”™è¯¯è¿‡æ»¤
- é‡å†™ `window.onerror`
- ä½¿ç”¨ `addEventListener('error')` ä½œä¸ºå¤‡ç”¨
- è¿”å› `true` é˜»æ­¢é»˜è®¤é”™è¯¯å¤„ç†

#### âœ… æ§åˆ¶å°é”™è¯¯è¿‡æ»¤
- é‡å†™ `console.error`
- é™é»˜å¤„ç†é’±åŒ…ç›¸å…³é”™è¯¯
- ä¿ç•™å…¶ä»–é”™è¯¯çš„æ­£å¸¸è¾“å‡º

### 3. å…³é”®è¯åŒ¹é…è§„åˆ™

```javascript
const walletKeywords = [
  'talisman',
  'sender', 
  'polkadot',
  'wallet',
  'getproviderstate',
  'extension has not been configured',
  'failed to get initial state'
];
```

## ğŸ”§ æŠ€æœ¯å®ç°ç‰¹ç‚¹

### 1. å¤šå±‚é˜²æŠ¤
- HTMLå†…è”è„šæœ¬ï¼šæœ€æ—©æœŸè¿‡æ»¤
- ErrorFilter.jsï¼šåº”ç”¨çº§è¿‡æ»¤
- ErrorHandler.jsï¼šå…œåº•æ£€æŸ¥

### 2. ä¼˜å…ˆçº§æ§åˆ¶
- ä½¿ç”¨äº‹ä»¶æ•è·é˜¶æ®µ (`true`)
- è°ƒç”¨ `stopImmediatePropagation()`
- ç¡®ä¿é’±åŒ…é”™è¯¯ä¸ä¼šä¼ æ’­åˆ°å…¶ä»–å¤„ç†å™¨

### 3. è°ƒè¯•å‹å¥½
- è¿‡æ»¤æ—¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯
- æä¾›ç»Ÿè®¡åŠŸèƒ½
- å¼€å‘ç¯å¢ƒä¸‹æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

## ğŸ“Š æµ‹è¯•éªŒè¯

### 1. æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•
1. æ‰“å¼€ `http://localhost:3334/h5/`
2. æ‰“å¼€å¼€å‘è€…å·¥å…·æ§åˆ¶å°
3. è§‚å¯Ÿæ˜¯å¦è¿˜æœ‰é’±åŒ…é”™è¯¯è¾“å‡º
4. åº”è¯¥çœ‹åˆ° `[é’±åŒ…é”™è¯¯è¿‡æ»¤]` çš„æ—¥å¿—ä¿¡æ¯

### 2. æ‰‹åŠ¨è§¦å‘æµ‹è¯•
åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
// æµ‹è¯•Promiseé”™è¯¯è¿‡æ»¤
Promise.reject(new Error('Talisman extension has not been configured'));

// æµ‹è¯•JavaScripté”™è¯¯è¿‡æ»¤
throw new Error('Sender: Failed to get initial state');

// æµ‹è¯•console.errorè¿‡æ»¤
console.error('polkadot wallet error');
```

### 3. é¢„æœŸç»“æœ
- âœ… é’±åŒ…é”™è¯¯ä¸åœ¨æ§åˆ¶å°æ˜¾ç¤ºçº¢è‰²é”™è¯¯
- âœ… æ˜¾ç¤ºç»¿è‰²çš„è¿‡æ»¤æ—¥å¿—ä¿¡æ¯
- âœ… æ­£å¸¸é”™è¯¯ä»ç„¶æ­£å¸¸æ˜¾ç¤º
- âœ… é¡µé¢åŠŸèƒ½å®Œå…¨æ­£å¸¸

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å¼€å‘ç¯å¢ƒ
- é”™è¯¯è¿‡æ»¤å™¨è‡ªåŠ¨å¯ç”¨
- æ˜¾ç¤ºè¯¦ç»†çš„è¿‡æ»¤æ—¥å¿—
- æä¾›è°ƒè¯•å’Œç»Ÿè®¡åŠŸèƒ½

### ç”Ÿäº§ç¯å¢ƒ
- é”™è¯¯è¿‡æ»¤å™¨è‡ªåŠ¨å¯ç”¨
- é™é»˜å¤„ç†ï¼Œä¸æ˜¾ç¤ºè¿‡æ»¤æ—¥å¿—
- å¯é€‰æ‹©ä¸ŠæŠ¥è¿‡æ»¤ç»Ÿè®¡åˆ°ç›‘æ§ç³»ç»Ÿ

## ğŸ” æ•…éšœæ’é™¤

### å¦‚æœé’±åŒ…é”™è¯¯ä»ç„¶æ˜¾ç¤ºï¼š

1. **æ£€æŸ¥åˆå§‹åŒ–é¡ºåº**
   ```javascript
   // ç¡®ä¿åœ¨main.jsä¸­æ­£ç¡®åˆå§‹åŒ–
   initErrorFilter(); // å…ˆåˆå§‹åŒ–è¿‡æ»¤å™¨
   initErrorHandler(); // ååˆå§‹åŒ–å¤„ç†å™¨
   ```

2. **æ£€æŸ¥å…³é”®è¯åŒ¹é…**
   - æŸ¥çœ‹é”™è¯¯æ¶ˆæ¯æ˜¯å¦åŒ…å«å·²çŸ¥å…³é”®è¯
   - å¦‚éœ€è¦ï¼Œæ·»åŠ æ–°çš„å…³é”®è¯åˆ°è¿‡æ»¤åˆ—è¡¨

3. **æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨ä¼˜å…ˆçº§**
   - ç¡®ä¿ä½¿ç”¨æ•è·é˜¶æ®µ (`true`)
   - ç¡®ä¿è°ƒç”¨ `stopImmediatePropagation()`

### è°ƒè¯•å‘½ä»¤
```javascript
// æŸ¥çœ‹è¿‡æ»¤ç»Ÿè®¡
console.log(window.errorFilter?.getFilterStats());

// é‡ç½®ç»Ÿè®¡
window.errorFilter?.resetStats();

// æ‰‹åŠ¨æµ‹è¯•è¿‡æ»¤
window.errorFilter?.shouldFilterError('Talisman extension error');
```

## ğŸ“ ç»´æŠ¤æŒ‡å—

### æ·»åŠ æ–°çš„è¿‡æ»¤è§„åˆ™
1. åœ¨ `index.html` çš„å†…è”è„šæœ¬ä¸­æ·»åŠ å…³é”®è¯
2. åœ¨ `errorFilter.js` ä¸­æ·»åŠ å…³é”®è¯
3. åœ¨ `errorHandler.js` ä¸­æ·»åŠ å…³é”®è¯

### æ€§èƒ½ç›‘æ§
- è¿‡æ»¤å™¨æœ¬èº«æ€§èƒ½å¼€é”€æå°
- å¯é€šè¿‡ç»Ÿè®¡åŠŸèƒ½ç›‘æ§è¿‡æ»¤æ•ˆæœ
- å»ºè®®å®šæœŸæ£€æŸ¥è¿‡æ»¤æ—¥å¿—

## ğŸ‰ æ€»ç»“

é€šè¿‡å®æ–½è¿™ä¸ªä¸‰å±‚é”™è¯¯è¿‡æ»¤æœºåˆ¶ï¼š
- **å½»åº•è§£å†³**äº†é’±åŒ…æ‰©å±•é”™è¯¯æ˜¾ç¤ºé—®é¢˜
- **ä¿æŒ**äº†æ‰€æœ‰æ­£å¸¸é”™è¯¯çš„å¤„ç†
- **æä¾›**äº†å®Œå–„çš„è°ƒè¯•å’Œç›‘æ§åŠŸèƒ½
- **ç¡®ä¿**äº†ç”¨æˆ·ä½“éªŒä¸å—å¹²æ‰°

ç°åœ¨h5-vueé¡¹ç›®å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸å†å—åˆ°é’±åŒ…æ‰©å±•é”™è¯¯çš„å›°æ‰°ï¼
