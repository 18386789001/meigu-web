<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H5-Vueé»˜è®¤è¯­è¨€è®¾ç½®éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-item {
            margin: 10px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .button:hover {
            background-color: #0056b3;
        }
        
        .button.success {
            background-color: #28a745;
        }
        
        .button.danger {
            background-color: #dc3545;
        }
        
        .error {
            color: red;
            background-color: #fff0f0;
        }
        
        .success {
            color: green;
            background-color: #f0fff0;
        }
        
        .info {
            color: blue;
            background-color: #f0f8ff;
        }
        
        .warning {
            color: orange;
            background-color: #fff8e1;
        }
        
        .step {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background-color: #f8f9fa;
        }
        
        .code {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .status-item {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .status-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-family: monospace;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>H5-Vueé»˜è®¤è¯­è¨€è®¾ç½®éªŒè¯</h1>
        
        <div class="test-item info">
            <h3>ğŸ¯ æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯H5-Vueåº”ç”¨åœ¨é¦–æ¬¡è®¿é—®æ—¶é»˜è®¤ä½¿ç”¨è‹±æ–‡è¯­è¨€</p>
            <p><strong>æµ‹è¯•URL:</strong> <code>http://localhost:3333/h5/</code></p>
        </div>
        
        <div class="test-item">
            <h3>ğŸ”§ ä¿®æ”¹å†…å®¹</h3>
            <div class="step">
                <strong>1. i18n/index.js:</strong> ä¿®æ”¹é»˜è®¤è¯­è¨€å’Œfallbackè¯­è¨€
            </div>
            <div class="code">
// ä¿®æ”¹å‰
fallbackLocale: 'zh-CN',
return 'zh-CN';

// ä¿®æ”¹å  
fallbackLocale: 'en-US',
return 'en-US';
            </div>
            
            <div class="step">
                <strong>2. utils/localStorage.js:</strong> ä¿®æ”¹é»˜è®¤fallbackè¯­è¨€
            </div>
            <div class="code">
// ä¿®æ”¹å‰
export function getValidLanguageCode(preferredLang, fallbackLang = 'zh-CN')

// ä¿®æ”¹å
export function getValidLanguageCode(preferredLang, fallbackLang = 'en-US')
            </div>
            
            <div class="step">
                <strong>3. main.js:</strong> ä¿®æ”¹é»˜è®¤è¯­è¨€è®¾ç½®
            </div>
            <div class="code">
// ä¿®æ”¹å‰
const validLang = getValidLanguageCode(savedLang, 'zh-CN');
localStorage.setItem('lang', 'zh-CN');

// ä¿®æ”¹å
const validLang = getValidLanguageCode(savedLang, 'en-US');
localStorage.setItem('lang', 'en-US');
            </div>
        </div>
        
        <div class="test-item">
            <h3>ğŸ§ª æµ‹è¯•æ“ä½œ</h3>
            <button class="button" onclick="clearLanguageStorage()">æ¸…é™¤è¯­è¨€å­˜å‚¨ï¼ˆæ¨¡æ‹Ÿé¦–æ¬¡è®¿é—®ï¼‰</button>
            <button class="button" onclick="setLanguage('zh-CN')">è®¾ç½®ä¸ºä¸­æ–‡</button>
            <button class="button" onclick="setLanguage('en-US')">è®¾ç½®ä¸ºè‹±æ–‡</button>
            <button class="button" onclick="simulateFirstVisit()">æ¨¡æ‹Ÿé¦–æ¬¡è®¿é—®</button>
            <button class="button success" onclick="openH5App()">æ‰“å¼€H5åº”ç”¨</button>
        </div>
        
        <div class="test-item">
            <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">localStorageä¸­çš„è¯­è¨€:</div>
                    <div class="status-value" id="stored-lang">-</div>
                </div>
                <div class="status-item">
                    <div class="status-label">æµè§ˆå™¨è¯­è¨€:</div>
                    <div class="status-value" id="browser-lang">-</div>
                </div>
                <div class="status-item">
                    <div class="status-label">å½“å‰URL:</div>
                    <div class="status-value" id="current-url">-</div>
                </div>
                <div class="status-item">
                    <div class="status-label">æ˜¯å¦é¦–æ¬¡è®¿é—®:</div>
                    <div class="status-value" id="is-first-visit">-</div>
                </div>
            </div>
        </div>
        
        <div id="test-results"></div>
        
        <div class="test-item warning">
            <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
            <ul>
                <li>é¦–æ¬¡è®¿é—®åº”ç”¨æ—¶åº”è¯¥é»˜è®¤æ˜¾ç¤ºè‹±æ–‡ç•Œé¢</li>
                <li>ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢è¯­è¨€åï¼Œåº”è¯¥è®°ä½ç”¨æˆ·çš„é€‰æ‹©</li>
                <li>æµè§ˆå™¨è¯­è¨€æ£€æµ‹åº”è¯¥æ­£å¸¸å·¥ä½œ</li>
                <li>localStorageæ¸…ç†ååº”è¯¥æ¢å¤è‹±æ–‡é»˜è®¤</li>
            </ul>
        </div>
        
        <div class="test-item success">
            <h3>âœ… é¢„æœŸç»“æœ</h3>
            <ul>
                <li>æ‰“å¼€ <code>http://localhost:3333/h5/</code> é»˜è®¤æ˜¾ç¤ºè‹±æ–‡ç•Œé¢</li>
                <li>localStorageä¸­æ²¡æœ‰è¯­è¨€è®¾ç½®æ—¶ï¼Œé»˜è®¤ä½¿ç”¨è‹±æ–‡</li>
                <li>æ‰€æœ‰ç•Œé¢å…ƒç´ éƒ½æ˜¾ç¤ºè‹±æ–‡ç¿»è¯‘</li>
                <li>è¯­è¨€åˆ‡æ¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>
    </div>

    <script>
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const storedLang = localStorage.getItem('lang');
            const browserLang = navigator.language || navigator.userLanguage;
            const currentUrl = window.location.href;
            const isFirstVisit = !localStorage.getItem('lang');
            
            document.getElementById('stored-lang').textContent = storedLang || 'null';
            document.getElementById('browser-lang').textContent = browserLang;
            document.getElementById('current-url').textContent = currentUrl;
            document.getElementById('is-first-visit').textContent = isFirstVisit ? 'æ˜¯' : 'å¦';
        }
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message, type = 'info') {
            const resultsContainer = document.getElementById('test-results');
            const testItem = document.createElement('div');
            testItem.className = `test-item ${type}`;
            testItem.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            resultsContainer.appendChild(testItem);
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }
        
        // æ¸…é™¤è¯­è¨€å­˜å‚¨
        function clearLanguageStorage() {
            localStorage.removeItem('lang');
            updateStatus();
            addTestResult('å·²æ¸…é™¤è¯­è¨€å­˜å‚¨ï¼Œæ¨¡æ‹Ÿé¦–æ¬¡è®¿é—®', 'info');
        }
        
        // è®¾ç½®è¯­è¨€
        function setLanguage(lang) {
            localStorage.setItem('lang', lang);
            updateStatus();
            addTestResult(`è¯­è¨€å·²è®¾ç½®ä¸º: ${lang}`, 'success');
        }
        
        // æ¨¡æ‹Ÿé¦–æ¬¡è®¿é—®
        function simulateFirstVisit() {
            // æ¸…é™¤æ‰€æœ‰è¯­è¨€ç›¸å…³å­˜å‚¨
            localStorage.removeItem('lang');
            localStorage.removeItem('userInfo');
            localStorage.removeItem('token');
            localStorage.removeItem('theme');
            
            updateStatus();
            addTestResult('å·²æ¨¡æ‹Ÿé¦–æ¬¡è®¿é—®ï¼Œæ‰€æœ‰å­˜å‚¨å·²æ¸…é™¤', 'warning');
            addTestResult('ç°åœ¨åº”è¯¥é»˜è®¤ä½¿ç”¨è‹±æ–‡è¯­è¨€', 'success');
        }
        
        // æ‰“å¼€H5åº”ç”¨
        function openH5App() {
            const h5Url = 'http://localhost:3333/h5/';
            addTestResult(`æ­£åœ¨æ‰“å¼€H5åº”ç”¨: ${h5Url}`, 'info');
            window.open(h5Url, '_blank');
        }
        
        // éªŒè¯è¯­è¨€è®¾ç½®é€»è¾‘
        function validateLanguageLogic() {
            addTestResult('å¼€å§‹éªŒè¯è¯­è¨€è®¾ç½®é€»è¾‘...', 'info');
            
            // æ¨¡æ‹ŸgetValidLanguageCodeå‡½æ•°
            function getValidLanguageCode(preferredLang, fallbackLang = 'en-US') {
                const supportedLanguages = [
                    'zh-CN', 'zh-TW', 'en-US', 'ja-JP', 'ko-KR', 
                    'th-TH', 'vi-VN', 'de-DE', 'es-ES', 'fr-FR', 
                    'it-IT', 'pt-PT', 'el-GR'
                ];
                
                if (supportedLanguages.includes(preferredLang)) {
                    return preferredLang;
                }
                
                if (supportedLanguages.includes(fallbackLang)) {
                    return fallbackLang;
                }
                
                return 'en-US';
            }
            
            // æµ‹è¯•å„ç§åœºæ™¯
            const testCases = [
                { preferred: null, fallback: 'en-US', expected: 'en-US', desc: 'é¦–é€‰è¯­è¨€ä¸ºnull' },
                { preferred: '', fallback: 'en-US', expected: 'en-US', desc: 'é¦–é€‰è¯­è¨€ä¸ºç©ºå­—ç¬¦ä¸²' },
                { preferred: 'zh-CN', fallback: 'en-US', expected: 'zh-CN', desc: 'é¦–é€‰è¯­è¨€ä¸ºä¸­æ–‡' },
                { preferred: 'invalid', fallback: 'en-US', expected: 'en-US', desc: 'é¦–é€‰è¯­è¨€æ— æ•ˆ' },
                { preferred: 'invalid', fallback: 'zh-CN', expected: 'zh-CN', desc: 'å¤‡ç”¨è¯­è¨€ä¸ºä¸­æ–‡' }
            ];
            
            testCases.forEach(testCase => {
                const result = getValidLanguageCode(testCase.preferred, testCase.fallback);
                const success = result === testCase.expected;
                const type = success ? 'success' : 'error';
                const icon = success ? 'âœ…' : 'âŒ';
                addTestResult(`${icon} ${testCase.desc}: ${result} (æœŸæœ›: ${testCase.expected})`, type);
            });
        }
        
        // åˆå§‹åŒ–
        updateStatus();
        addTestResult('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼ŒH5-Vueé»˜è®¤è¯­è¨€è®¾ç½®éªŒè¯å¼€å§‹', 'success');
        
        // éªŒè¯è¯­è¨€è®¾ç½®é€»è¾‘
        validateLanguageLogic();
        
        // æ£€æŸ¥å½“å‰çŠ¶æ€
        const currentLang = localStorage.getItem('lang');
        if (!currentLang) {
            addTestResult('æ£€æµ‹åˆ°é¦–æ¬¡è®¿é—®çŠ¶æ€ï¼Œåº”è¯¥é»˜è®¤ä½¿ç”¨è‹±æ–‡', 'info');
        } else {
            addTestResult(`å½“å‰è¯­è¨€è®¾ç½®: ${currentLang}`, 'info');
        }
        
        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(updateStatus, 2000);
    </script>
</body>
</html>
