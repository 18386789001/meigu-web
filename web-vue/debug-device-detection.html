<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡æ£€æµ‹è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        .info-item {
            margin: 5px 0;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 3px;
        }
        .mobile { color: #e74c3c; font-weight: bold; }
        .desktop { color: #27ae60; font-weight: bold; }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .result.mobile {
            background: #fdf2f2;
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }
        .result.desktop {
            background: #f0f9f0;
            border: 1px solid #27ae60;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>è®¾å¤‡æ£€æµ‹è°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h3>å½“å‰è®¾å¤‡ä¿¡æ¯</h3>
            <div id="deviceInfo"></div>
        </div>
        
        <div class="section">
            <h3>UserAgent åˆ†æ</h3>
            <div id="userAgentInfo"></div>
        </div>
        
        <div class="section">
            <h3>å±å¹•ä¿¡æ¯</h3>
            <div id="screenInfo"></div>
        </div>
        
        <div class="section">
            <h3>æ£€æµ‹ç»“æœ</h3>
            <div id="detectionResult"></div>
            <button class="test-button" onclick="testDetection()">é‡æ–°æ£€æµ‹</button>
            <button class="test-button" onclick="simulateMobile()">æ¨¡æ‹Ÿç§»åŠ¨ç«¯</button>
            <button class="test-button" onclick="simulateDesktop()">æ¨¡æ‹Ÿæ¡Œé¢ç«¯</button>
        </div>
        
        <div class="section">
            <h3>è·³è½¬æµ‹è¯•</h3>
            <button class="test-button" onclick="testRedirect()">æµ‹è¯•è·³è½¬é€»è¾‘</button>
            <div id="redirectResult"></div>
        </div>
    </div>

    <script>
        // ç§»åŠ¨è®¾å¤‡UserAgentå…³é”®è¯
        const MOBILE_KEYWORDS = [
            'mobile', 'phone', 'pad', 'pod', 'tablet',
            'iphone', 'ipod', 'ios', 'ipad',
            'android', 'androidphone', 'androidtablet',
            'blackberry', 'iemobile', 'mobile safari',
            'mqqbrowser', 'juc', 'micromessenger', 'wechat',
            'qqbrowser', 'baiduboxapp', 'baidubrowser',
            '360browser', '360phonebrowser', 'qhbrowser',
            'ucbrowser', 'ucweb', 'opera mini', 'opera mobi',
            'fennec', 'wosbrowser', 'browserng', 'webos',
            'symbian', 'windows phone', 'windows mobile',
            'kindle', 'silk', 'playbook', 'nook',
            'smartphone', 'smarttv', 'smartwatch',
            'samsung', 'huawei', 'xiaomi', 'oppo', 'vivo',
            'oneplus', 'meizu', 'zte', 'lenovo', 'motorola',
            'lg', 'sony', 'htc', 'nokia'
        ];

        const MOBILE_BROWSER_KEYWORDS = [
            'mobile safari', 'chrome mobile', 'firefox mobile',
            'edge mobile', 'opera mobile', 'samsung browser',
            'huawei browser', 'miui browser', 'oppo browser',
            'vivo browser', 'uc browser', 'qq browser',
            'baidu browser', '360 browser', 'sogou browser',
            'maxthon mobile', 'liebao mobile'
        ];

        function isMobileByUserAgent() {
            const userAgent = navigator.userAgent.toLowerCase();
            
            // é¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºæ¡Œé¢æµè§ˆå™¨ï¼ˆæ’é™¤ç§»åŠ¨ç«¯ï¼‰
            const isDesktopBrowser = userAgent.includes('windows nt') || 
                                    userAgent.includes('macintosh') || 
                                    userAgent.includes('linux') ||
                                    userAgent.includes('x11');
            
            // å¦‚æœæ˜¯æ¡Œé¢æµè§ˆå™¨ä¸”æ²¡æœ‰æ˜ç¡®çš„ç§»åŠ¨è®¾å¤‡æ ‡è¯†ï¼Œåˆ™ä¸æ˜¯ç§»åŠ¨ç«¯
            if (isDesktopBrowser && !userAgent.includes('mobile') && !userAgent.includes('android')) {
                return false;
            }
            
            // æ£€æŸ¥æ˜ç¡®çš„ç§»åŠ¨è®¾å¤‡å…³é”®è¯
            const hasMobileKeyword = MOBILE_KEYWORDS.some(keyword => 
                userAgent.includes(keyword.toLowerCase())
            );
            
            // æ£€æŸ¥ç§»åŠ¨æµè§ˆå™¨å…³é”®è¯
            const hasMobileBrowser = MOBILE_BROWSER_KEYWORDS.some(keyword => 
                userAgent.includes(keyword.toLowerCase())
            );
            
            return hasMobileKeyword || hasMobileBrowser;
        }

        function isMobileByScreenSize() {
            const { innerWidth, innerHeight } = window;
            
            // æ£€æŸ¥å±å¹•å®½åº¦å’Œé«˜åº¦ - æ›´ä¸¥æ ¼çš„åˆ¤æ–­
            const isSmallScreen = innerWidth <= 768 && innerHeight <= 1024;
            
            // æ£€æŸ¥å±å¹•æ¯”ä¾‹ï¼ˆç§»åŠ¨è®¾å¤‡é€šå¸¸å®½é«˜æ¯”ä¸åŒï¼‰- æ›´ä¸¥æ ¼çš„æ¯”ä¾‹åˆ¤æ–­
            const aspectRatio = innerWidth / innerHeight;
            const isMobileRatio = aspectRatio < 0.5 || aspectRatio > 2.0;
            
            // åŒæ—¶æ»¡è¶³å°å±å¹•å’Œç§»åŠ¨è®¾å¤‡æ¯”ä¾‹æ‰è®¤ä¸ºæ˜¯ç§»åŠ¨ç«¯
            return isSmallScreen && isMobileRatio;
        }

        function isTouchDevice() {
            return (
                'ontouchstart' in window ||
                navigator.maxTouchPoints > 0 ||
                navigator.msMaxTouchPoints > 0
            );
        }

        function isTablet() {
            const userAgent = navigator.userAgent.toLowerCase();
            const { innerWidth, innerHeight } = window;
            
            // æ£€æŸ¥å¹³æ¿å…³é”®è¯
            const hasTabletKeyword = userAgent.includes('ipad') || 
                                    userAgent.includes('tablet') ||
                                    userAgent.includes('kindle') ||
                                    userAgent.includes('playbook');
            
            // æ£€æŸ¥å¹³æ¿å±å¹•å°ºå¯¸
            const isTabletScreen = innerWidth > 768 && 
                                  innerWidth <= 1024 &&
                                  innerHeight <= 1366;
            
            return hasTabletKeyword || isTabletScreen;
        }

        function isMobileDevice() {
            // 1. åŸºäºUserAgentæ£€æµ‹ï¼ˆä¸»è¦åˆ¤æ–­ä¾æ®ï¼‰
            const userAgentMobile = isMobileByUserAgent();
            
            // 2. åŸºäºå±å¹•å°ºå¯¸æ£€æµ‹ï¼ˆè¾…åŠ©åˆ¤æ–­ï¼‰
            const screenMobile = isMobileByScreenSize();
            
            // 3. æ£€æµ‹è§¦æ‘¸è®¾å¤‡
            const isTouch = isTouchDevice();
            
            // 4. æ£€æµ‹å¹³æ¿ï¼ˆå¹³æ¿ä¹Ÿè§†ä¸ºç§»åŠ¨ç«¯ï¼‰
            const isTabletDevice = isTablet();
            
            // ä¼˜å…ˆä½¿ç”¨UserAgentæ£€æµ‹ï¼Œåªæœ‰åœ¨UserAgentæ˜ç¡®æŒ‡ç¤ºç§»åŠ¨è®¾å¤‡æ—¶æ‰è·³è½¬
            // é¿å…PCç«¯æµè§ˆå™¨è¢«è¯¯åˆ¤ä¸ºç§»åŠ¨ç«¯
            if (userAgentMobile) {
                return true;
            }
            
            // å¦‚æœUserAgentæ²¡æœ‰æ˜ç¡®æŒ‡ç¤ºç§»åŠ¨è®¾å¤‡ï¼Œä½†å±å¹•å¾ˆå°ä¸”æ˜¯è§¦æ‘¸è®¾å¤‡ï¼Œä¹Ÿè®¤ä¸ºæ˜¯ç§»åŠ¨ç«¯
            if (screenMobile && isTouch) {
                return true;
            }
            
            // å¹³æ¿è®¾å¤‡ä¹Ÿè®¤ä¸ºæ˜¯ç§»åŠ¨ç«¯
            if (isTabletDevice) {
                return true;
            }
            
            return false;
        }

        function getDeviceInfo() {
            return {
                isMobile: isMobileDevice(),
                isTablet: isTablet(),
                isTouch: isTouchDevice(),
                userAgent: navigator.userAgent,
                screenSize: {
                    width: window.innerWidth,
                    height: window.innerHeight
                },
                userAgentMobile: isMobileByUserAgent(),
                screenMobile: isMobileByScreenSize()
            };
        }

        function updateDisplay() {
            const deviceInfo = getDeviceInfo();
            
            // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
            document.getElementById('deviceInfo').innerHTML = `
                <div class="info-item"><strong>æ˜¯å¦ä¸ºç§»åŠ¨ç«¯:</strong> <span class="${deviceInfo.isMobile ? 'mobile' : 'desktop'}">${deviceInfo.isMobile ? 'æ˜¯' : 'å¦'}</span></div>
                <div class="info-item"><strong>æ˜¯å¦ä¸ºå¹³æ¿:</strong> ${deviceInfo.isTablet ? 'æ˜¯' : 'å¦'}</div>
                <div class="info-item"><strong>æ˜¯å¦æ”¯æŒè§¦æ‘¸:</strong> ${deviceInfo.isTouch ? 'æ˜¯' : 'å¦'}</div>
                <div class="info-item"><strong>UserAgentæ£€æµ‹:</strong> <span class="${deviceInfo.userAgentMobile ? 'mobile' : 'desktop'}">${deviceInfo.userAgentMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}</span></div>
                <div class="info-item"><strong>å±å¹•å°ºå¯¸æ£€æµ‹:</strong> <span class="${deviceInfo.screenMobile ? 'mobile' : 'desktop'}">${deviceInfo.screenMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}</span></div>
            `;
            
            // æ˜¾ç¤ºUserAgentä¿¡æ¯
            document.getElementById('userAgentInfo').innerHTML = `
                <div class="info-item"><strong>UserAgent:</strong> ${deviceInfo.userAgent}</div>
                <div class="info-item"><strong>æ£€æµ‹åˆ°çš„å…³é”®è¯:</strong> ${getDetectedKeywords()}</div>
            `;
            
            // æ˜¾ç¤ºå±å¹•ä¿¡æ¯
            document.getElementById('screenInfo').innerHTML = `
                <div class="info-item"><strong>å±å¹•å°ºå¯¸:</strong> ${deviceInfo.screenSize.width} x ${deviceInfo.screenSize.height}</div>
                <div class="info-item"><strong>å®½é«˜æ¯”:</strong> ${(deviceInfo.screenSize.width / deviceInfo.screenSize.height).toFixed(2)}</div>
                <div class="info-item"><strong>æœ€å¤§è§¦æ‘¸ç‚¹æ•°:</strong> ${navigator.maxTouchPoints || 0}</div>
            `;
            
            // æ˜¾ç¤ºæ£€æµ‹ç»“æœ
            const resultDiv = document.getElementById('detectionResult');
            resultDiv.className = `result ${deviceInfo.isMobile ? 'mobile' : 'desktop'}`;
            resultDiv.innerHTML = `
                æœ€ç»ˆæ£€æµ‹ç»“æœ: ${deviceInfo.isMobile ? 'ç§»åŠ¨ç«¯è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡'}
                <br>
                å»ºè®®æ“ä½œ: ${deviceInfo.isMobile ? 'åº”è¯¥è·³è½¬åˆ°H5ç«¯' : 'åº”è¯¥ä½¿ç”¨PCç«¯ç•Œé¢'}
            `;
        }

        function getDetectedKeywords() {
            const userAgent = navigator.userAgent.toLowerCase();
            const detectedKeywords = [];
            
            MOBILE_KEYWORDS.forEach(keyword => {
                if (userAgent.includes(keyword.toLowerCase())) {
                    detectedKeywords.push(keyword);
                }
            });
            
            MOBILE_BROWSER_KEYWORDS.forEach(keyword => {
                if (userAgent.includes(keyword.toLowerCase())) {
                    detectedKeywords.push(keyword);
                }
            });
            
            return detectedKeywords.length > 0 ? detectedKeywords.join(', ') : 'æ— ';
        }

        function testDetection() {
            console.log('=== é‡æ–°æ£€æµ‹è®¾å¤‡ ===');
            updateDisplay();
        }

        function simulateMobile() {
            // ä¸´æ—¶ä¿®æ”¹UserAgentè¿›è¡Œæµ‹è¯•
            const originalUserAgent = navigator.userAgent;
            Object.defineProperty(navigator, 'userAgent', {
                value: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Mobile/15E148 Safari/604.1',
                configurable: true
            });
            
            setTimeout(() => {
                updateDisplay();
                Object.defineProperty(navigator, 'userAgent', {
                    value: originalUserAgent,
                    configurable: true
                });
            }, 100);
        }

        function simulateDesktop() {
            updateDisplay();
        }

        function testRedirect() {
            const deviceInfo = getDeviceInfo();
            const resultDiv = document.getElementById('redirectResult');
            
            if (deviceInfo.isMobile) {
                resultDiv.innerHTML = `
                    <div class="result mobile">
                        ğŸš€ æ£€æµ‹åˆ°ç§»åŠ¨ç«¯è®¾å¤‡ï¼Œåº”è¯¥è·³è½¬åˆ°H5ç«¯<br>
                        <strong>è·³è½¬URL:</strong> http://localhost:3333/h5/
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="result desktop">
                        ğŸ–¥ï¸ æ£€æµ‹åˆ°æ¡Œé¢è®¾å¤‡ï¼Œç»§ç»­ä½¿ç”¨PCç«¯ç•Œé¢<br>
                        <strong>å½“å‰URL:</strong> http://localhost:5173/
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateDisplay();
        });

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', () => {
            setTimeout(updateDisplay, 100);
        });
    </script>
</body>
</html>
