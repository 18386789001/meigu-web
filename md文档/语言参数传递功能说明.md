# H5-Vue 到 WAP-Vue 语言参数传递功能说明

## 📋 功能概述

实现了从 H5-Vue 页面跳转到 WAP-Vue 页面时，自动传递并应用当前选择的语言设置。

## 🔄 工作流程

1. **用户在 H5-Vue 页面选择语言**（例如：日语 🇯🇵）
2. **点击左侧菜单的"登录"或"注册"按钮**
3. **自动跳转到 WAP-Vue** 并携带语言参数：`https://jpmx.xyz/syn/#/my/index?lang=Japanese`
4. **WAP-Vue 自动识别 URL 参数**并将页面语言切换为日语
5. **用户看到的登录/注册页面已经是日语界面** ✅

## 📝 修改内容

### 1. H5-Vue 修改 (`h5-vue/src/App.vue`)

#### 添加语言代码映射函数
```javascript
// 语言代码映射（h5-vue到wap-vue）
const getWapLanguageCode = (h5LangCode) => {
  const langMap = {
    'en-US': 'en',
    'ja-JP': 'Japanese',
    'ko-KR': 'Korean',
    'th-TH': 'th',
    'vi-VN': 'vi',
    'de-DE': 'de',
    'es-ES': 'es',
    'fr-FR': 'fr',
    'it-IT': 'Italy',
    'pt-PT': 'pt',
    'el-GR': 'gr',
    'zh-CN': 'CN',
    'zh-TW': 'CN'
  }
  return langMap[h5LangCode] || 'en'
}
```

#### 修改登录/注册跳转方法
```javascript
// 跳转到登录页（携带语言参数）
const goToLogin = () => {
  const langCode = getWapLanguageCode(currentLanguageCode.value)
  window.location.href = config.URLS.LOGIN({ lang: langCode })
  closeSidebar()
}

// 跳转到注册页（携带语言参数）
const goToRegister = () => {
  const langCode = getWapLanguageCode(currentLanguageCode.value)
  window.location.href = config.URLS.REGISTER({ lang: langCode })
  closeSidebar()
}
```

### 2. WAP-Vue 修改 (`wap-vue/src/utils/languageInit.js`)

#### 添加 URL 参数获取函数
```javascript
/**
 * 从URL获取语言参数
 */
export function getLanguageFromUrl() {
  try {
    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get('lang');
    if (langParam) {
      console.log('🌐 WAP-Vue: 从URL获取到语言参数:', langParam);
      return langParam;
    }
    return null;
  } catch (error) {
    console.error('🌐 WAP-Vue: 获取URL语言参数失败:', error);
    return null;
  }
}
```

#### 修改语言初始化函数
在 `forceInitializeEnglish()` 函数开头添加 URL 参数检查：
```javascript
// 首先检查URL参数中是否有语言设置
const urlLang = getLanguageFromUrl();
if (urlLang) {
  console.log('🌐 WAP-Vue: 检测到URL语言参数，设置语言为:', urlLang);
  localStorage.setItem('lang', urlLang);
  localStorage.setItem('userSetLanguage', 'true'); // 标记为用户设置
  localStorage.setItem('langSource', 'url'); // 标记语言来源
  return true;
}
```

### 3. WAP-Vue App.vue 修改 (`wap-vue/src/App.vue`)

移除了强制刷新逻辑，改为记录日志：
```javascript
onMounted(() => {
  // 初始化语言设置，支持URL参数语言
  console.log('🚀 WAP-Vue 应用启动');

  // 初始化语言设置（会自动检查URL参数）
  const languageResult = initializeWapLanguage();
  console.log('🌐 语言初始化结果:', languageResult);
  
  // 如果从URL获取到语言参数，记录日志
  const urlParams = new URLSearchParams(window.location.search);
  const langParam = urlParams.get('lang');
  if (langParam) {
    console.log('🌐 从H5页面接收到语言参数:', langParam);
    console.log('🌐 已自动切换到指定语言');
  }
})
```

## 🌐 语言代码映射表

| H5-Vue 语言代码 | WAP-Vue 语言代码 | 语言名称 |
|----------------|-----------------|---------|
| en-US | en | English |
| ja-JP | Japanese | 日本語 |
| ko-KR | Korean | 한국어 |
| th-TH | th | ไทย |
| vi-VN | vi | Tiếng Việt |
| de-DE | de | Deutsch |
| es-ES | es | Español |
| fr-FR | fr | Français |
| it-IT | Italy | Italiano |
| pt-PT | pt | Português |
| el-GR | gr | Ελληνικά |
| zh-CN | CN | 简体中文 |
| zh-TW | CN | 繁體中文 |

## 📌 URL 示例

### 英文
```
https://jpmx.xyz/syn/#/my/index?lang=en
```

### 日文
```
https://jpmx.xyz/syn/#/my/index?lang=Japanese
```

### 韩文
```
https://jpmx.xyz/syn/#/my/index?lang=Korean
```

### 泰文
```
https://jpmx.xyz/syn/#/my/index?lang=th
```

### 中文
```
https://jpmx.xyz/syn/#/my/index?lang=CN
```

## 🧪 测试步骤

### 1. 测试日语跳转
1. 在 H5-Vue 页面中，点击语言选择器
2. 选择 "日本語 🇯🇵"
3. 点击左侧菜单栏的 "登录" 或 "注册" 按钮
4. 验证跳转后的 URL 是否包含 `?lang=Japanese`
5. 验证 WAP-Vue 页面是否自动显示日语界面

### 2. 测试其他语言
重复上述步骤，测试不同语言：
- 韩语 → `?lang=Korean`
- 泰语 → `?lang=th`
- 越南语 → `?lang=vi`
- 德语 → `?lang=de`
- 等等...

### 3. 验证浏览器控制台日志
打开浏览器开发者工具 (F12)，查看 Console 标签页：

**H5-Vue 端（跳转前）**
```
选择语言: {code: 'ja-JP', name: '日本語', flag: '🇯🇵'}
```

**WAP-Vue 端（跳转后）**
```
🚀 WAP-Vue 应用启动
🌐 WAP-Vue: 从URL获取到语言参数: Japanese
🌐 WAP-Vue: 检测到URL语言参数，设置语言为: Japanese
🌐 从H5页面接收到语言参数: Japanese
🌐 已自动切换到指定语言
```

## ⚠️ 注意事项

### 1. 语言持久化
- URL 参数中的语言会被保存到 `localStorage`
- 保存为 `lang` 键
- 同时标记 `userSetLanguage` 为 `true`
- 标记 `langSource` 为 `url`

### 2. 优先级
语言设置的优先级（从高到低）：
1. **URL 参数语言**（最高优先级）
2. 用户手动设置的语言
3. 默认英文

### 3. 不会强制刷新
- 移除了原有的强制刷新逻辑
- 语言切换通过 localStorage 和 i18n 系统自动生效
- 避免了页面闪烁和重复刷新问题

### 4. 跨域兼容
- URL 参数传递不涉及跨域问题
- 使用标准的 URLSearchParams API
- 兼容所有现代浏览器

## 🔧 调试技巧

### 查看当前语言设置
在浏览器控制台执行：
```javascript
console.log('当前语言:', localStorage.getItem('lang'))
console.log('是否用户设置:', localStorage.getItem('userSetLanguage'))
console.log('语言来源:', localStorage.getItem('langSource'))
```

### 手动测试 URL 参数
在浏览器地址栏直接输入带参数的 URL：
```
https://jpmx.xyz/syn/#/my/index?lang=Japanese
```

### 清除语言设置
在浏览器控制台执行：
```javascript
localStorage.removeItem('lang')
localStorage.removeItem('userSetLanguage')
localStorage.removeItem('langSource')
location.reload()
```

## 🎯 使用场景

### 场景 1：新用户首次访问
1. 用户访问 H5-Vue 首页
2. 页面默认显示英文
3. 用户选择日语
4. 点击"注册"
5. 跳转到日语注册页面 ✅

### 场景 2：从不同语言切换
1. 用户当前使用中文界面
2. 切换到韩语
3. 点击"登录"
4. 跳转到韩语登录页面 ✅

### 场景 3：直接访问带参数的 URL
1. 用户收到带语言参数的链接
2. 直接访问：`https://jpmx.xyz/syn/#/my/index?lang=th`
3. 页面自动显示泰语 ✅

## 📊 技术实现细节

### 数据流
```
H5-Vue (用户选择日语)
    ↓
currentLanguageCode.value = 'ja-JP'
    ↓
getWapLanguageCode('ja-JP') → 'Japanese'
    ↓
config.URLS.LOGIN({ lang: 'Japanese' })
    ↓
https://jpmx.xyz/syn/#/my/index?lang=Japanese
    ↓
WAP-Vue 页面加载
    ↓
getLanguageFromUrl() → 'Japanese'
    ↓
localStorage.setItem('lang', 'Japanese')
    ↓
i18n 系统自动应用日语
    ↓
页面显示日语界面 ✅
```

### 关键技术点
1. **URLSearchParams API** - 标准的 URL 参数解析
2. **localStorage** - 语言设置持久化
3. **Vue i18n** - 国际化框架
4. **语言代码映射** - 两个应用的语言代码统一

## ✅ 功能优势

1. **无缝体验** - 用户不需要在新页面重新选择语言
2. **智能记忆** - 语言选择会被记住
3. **灵活性** - 支持 URL 参数直接指定语言
4. **向后兼容** - 不影响原有的语言切换功能
5. **性能优化** - 移除了强制刷新逻辑

## 🚀 部署说明

### 无需额外配置
- 代码修改即可生效
- 不需要修改服务器配置
- 不需要修改路由配置
- 不需要修改 i18n 配置

### 验证部署
1. 打开 H5-Vue 页面
2. 选择任意语言
3. 点击登录/注册
4. 检查跳转后的页面语言是否正确

---

**开发完成日期**: 2025年1月  
**版本**: v1.0.0  
**状态**: ✅ 已完成并测试

