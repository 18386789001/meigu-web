# MT5ç”Ÿäº§ç¯å¢ƒé—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

### 1. è®¤è¯è¿‡æœŸé—®é¢˜ (403é”™è¯¯)
**é”™è¯¯ä¿¡æ¯**: `{"code":403,"msg":"æ‚¨çš„è´¦å·å·²è¿‡æœŸæˆ–å·²ç»åœ¨å…¶ä»–åœ°æ–¹ç™»å½•ï¼Œè¯·é‡æ–°ç™»å½•"}`

**åŸå› åˆ†æ**:
- Tokenè¿‡æœŸæˆ–æ— æ•ˆ
- ç”¨æˆ·åœ¨å¤šä¸ªè®¾å¤‡åŒæ—¶ç™»å½•ï¼Œå¯¼è‡´Tokenå†²çª
- æœåŠ¡å™¨ç«¯Sessionç®¡ç†é—®é¢˜

### 2. é’±åŒ…æ‰©å±•è¿æ¥é—®é¢˜
**é”™è¯¯ä¿¡æ¯**:
- `Sender: Failed to get initial state`
- `Talisman extension has not been configured yet`
- `Disconnected from polkadot{.js}`

**åŸå› åˆ†æ**:
- æµè§ˆå™¨æ‰©å±•æœªæ­£ç¡®å®‰è£…æˆ–é…ç½®
- é’±åŒ…æ‰©å±•ä¸ç½‘ç«™é›†æˆé—®é¢˜
- Polkadot.jsè¿æ¥ä¸­æ–­

### 3. èµ„æºåŠ è½½é—®é¢˜
**é”™è¯¯ä¿¡æ¯**: `GET https://jpmx.xyz/favicon.ico 404 (Not Found)`

**åŸå› åˆ†æ**:
- favicon.icoæ–‡ä»¶ç¼ºå¤±
- é™æ€èµ„æºé…ç½®é—®é¢˜

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šè®¤è¯é—®é¢˜ä¿®å¤

#### 1.1 åç«¯Tokenç®¡ç†ä¼˜åŒ–
```javascript
// å»ºè®®åœ¨åç«¯å®ç°ä»¥ä¸‹é€»è¾‘
const tokenManagement = {
  // å»¶é•¿Tokenæœ‰æ•ˆæœŸ
  extendTokenExpiry: (token) => {
    // å°†Tokenæœ‰æ•ˆæœŸä»1å°æ—¶å»¶é•¿åˆ°24å°æ—¶
    return jwt.sign(payload, secret, { expiresIn: '24h' });
  },
  
  // å®ç°Tokenåˆ·æ–°æœºåˆ¶
  refreshToken: (refreshToken) => {
    // è‡ªåŠ¨åˆ·æ–°Tokenï¼Œé¿å…é¢‘ç¹ç™»å½•
    return newToken;
  },
  
  // å•ç‚¹ç™»å½•æ§åˆ¶
  singleSignOn: (userId) => {
    // å…è®¸åŒä¸€ç”¨æˆ·åœ¨å¤šè®¾å¤‡ç™»å½•ï¼Œæˆ–é™åˆ¶å•è®¾å¤‡ç™»å½•
    return allowMultipleDevices;
  }
};
```

#### 1.2 å‰ç«¯Tokenå¤„ç†ä¼˜åŒ–
```javascript
// åœ¨ src/utils/http.js ä¸­æ·»åŠ Tokenè‡ªåŠ¨åˆ·æ–°
const tokenRefreshInterceptor = {
  onResponseError: (error) => {
    if (error.response?.status === 403) {
      // å°è¯•åˆ·æ–°Token
      return refreshTokenAndRetry(error.config);
    }
    return Promise.reject(error);
  }
};
```

### æ–¹æ¡ˆäºŒï¼šé’±åŒ…æ‰©å±•é—®é¢˜ä¿®å¤

#### 2.1 æ·»åŠ é’±åŒ…æ£€æµ‹å’Œé™çº§å¤„ç†
```javascript
// åœ¨ src/utils/walletDetector.js ä¸­æ·»åŠ 
export const walletDetection = {
  // æ£€æµ‹é’±åŒ…æ‰©å±•æ˜¯å¦å¯ç”¨
  checkWalletAvailability: async () => {
    try {
      // æ£€æµ‹Senderé’±åŒ…
      if (window.sender) {
        return { sender: true, talisman: false };
      }
      // æ£€æµ‹Talismané’±åŒ…
      if (window.talisman) {
        return { sender: false, talisman: true };
      }
      return { sender: false, talisman: false };
    } catch (error) {
      console.warn('é’±åŒ…æ£€æµ‹å¤±è´¥:', error);
      return { sender: false, talisman: false };
    }
  },
  
  // ä¼˜é›…é™çº§å¤„ç†
  gracefulFallback: () => {
    // å½“é’±åŒ…æ‰©å±•ä¸å¯ç”¨æ—¶ï¼Œæ˜¾ç¤ºå‹å¥½çš„æç¤ºä¿¡æ¯
    ElMessage.warning('é’±åŒ…æ‰©å±•æœªæ£€æµ‹åˆ°ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨');
  }
};
```

#### 2.2 é’±åŒ…è¿æ¥é”™è¯¯å¤„ç†
```javascript
// åœ¨é’±åŒ…ç›¸å…³ç»„ä»¶ä¸­æ·»åŠ é”™è¯¯è¾¹ç•Œ
const walletErrorHandler = {
  handleConnectionError: (error) => {
    if (error.message.includes('not been configured')) {
      ElMessage.info('è¯·å…ˆé…ç½®é’±åŒ…æ‰©å±•');
    } else if (error.message.includes('Failed to get initial state')) {
      ElMessage.warning('é’±åŒ…è¿æ¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
    }
  }
};
```

### æ–¹æ¡ˆä¸‰ï¼šé™æ€èµ„æºé—®é¢˜ä¿®å¤

#### 3.1 æ·»åŠ favicon.icoæ–‡ä»¶
```bash
# åœ¨ public ç›®å½•ä¸‹æ·»åŠ  favicon.ico
# æˆ–è€…åœ¨ index.html ä¸­æŒ‡å®šæ­£ç¡®çš„faviconè·¯å¾„
<link rel="icon" type="image/x-icon" href="/favicon.ico">
```

#### 3.2 é™æ€èµ„æºé…ç½®ä¼˜åŒ–
```javascript
// åœ¨ vite.config.js ä¸­é…ç½®é™æ€èµ„æº
export default {
  build: {
    assetsDir: 'assets',
    rollupOptions: {
      output: {
        assetFileNames: 'assets/[name]-[hash][extname]'
      }
    }
  }
};
```

## ğŸ”§ ç«‹å³ä¿®å¤æ­¥éª¤

### æ­¥éª¤1: ä¿®å¤faviconé—®é¢˜
1. åœ¨ `public` ç›®å½•ä¸‹æ·»åŠ  `favicon.ico` æ–‡ä»¶
2. æˆ–åœ¨ `index.html` ä¸­æ³¨é‡Šæ‰faviconå¼•
ç”¨

### æ­¥éª¤2: ä¼˜åŒ–è®¤è¯å¤„ç†
1. åœ¨åç«¯å»¶é•¿Tokenæœ‰æ•ˆæœŸ
2. å®ç°Tokenè‡ªåŠ¨åˆ·æ–°æœºåˆ¶
3. æ·»åŠ æ›´å‹å¥½çš„é”™è¯¯æç¤º

### æ­¥éª¤3: é’±åŒ…æ‰©å±•é™çº§å¤„ç†
1. æ·»åŠ é’±åŒ…æ£€æµ‹é€»è¾‘
2. å®ç°ä¼˜é›…é™çº§
3. æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯

### æ­¥éª¤4: ç”Ÿäº§ç¯å¢ƒé…ç½®æ£€æŸ¥
1. æ£€æŸ¥APIæ¥å£åœ°å€é…ç½®
2. éªŒè¯HTTPSè¯ä¹¦é…ç½®
3. ç¡®è®¤è·¨åŸŸè®¾ç½®æ­£ç¡®

## ğŸ“ ç›‘æ§å’Œæ—¥å¿—

### æ·»åŠ é”™è¯¯ç›‘æ§
```javascript
// å…¨å±€é”™è¯¯ç›‘æ§
window.addEventListener('error', (event) => {
  console.error('å…¨å±€é”™è¯¯:', event.error);
  // å‘é€é”™è¯¯æ—¥å¿—åˆ°ç›‘æ§ç³»ç»Ÿ
});

// Promiseé”™è¯¯ç›‘æ§
window.addEventListener('unhandledrejection', (event) => {
  console.error('æœªå¤„ç†çš„Promiseé”™è¯¯:', event.reason);
});
```

## ğŸš€ éƒ¨ç½²å»ºè®®

1. **åˆ†é˜¶æ®µéƒ¨ç½²**: å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ä¿®å¤æ–¹æ¡ˆ
2. **å›æ»šå‡†å¤‡**: å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
3. **ç›‘æ§å‘Šè­¦**: è®¾ç½®å…³é”®æŒ‡æ ‡ç›‘æ§
4. **ç”¨æˆ·é€šçŸ¥**: æå‰é€šçŸ¥ç”¨æˆ·å¯èƒ½çš„ç»´æŠ¤æ—¶é—´

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œå»ºè®®ï¼š
1. æ”¶é›†å®Œæ•´çš„é”™è¯¯æ—¥å¿—
2. æ£€æŸ¥æœåŠ¡å™¨ç«¯æ—¥å¿—
3. éªŒè¯æ•°æ®åº“è¿æ¥çŠ¶æ€
4. è”ç³»åç«¯å¼€å‘å›¢é˜Ÿæ’æŸ¥Tokenç®¡ç†é€»è¾‘
