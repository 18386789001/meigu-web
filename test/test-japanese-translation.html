<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­ç¿»è¯‘åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .original-text {
            background: #f0f8ff;
            padding: 10px;
            border-left: 4px solid #007bff;
            margin: 10px 0;
        }
        .translated-text {
            background: #f0fff0;
            padding: 10px;
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }
        .error-text {
            background: #fff0f0;
            padding: 10px;
            border-left: 4px solid #dc3545;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‡¯ğŸ‡µ æ—¥è¯­ç¿»è¯‘åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•æ—¥è¯­ç¿»è¯‘æœåŠ¡æ˜¯å¦èƒ½æ­£ç¡®å°†ä¸­æ–‡æ–°é—»ç¿»è¯‘ä¸ºæ—¥æ–‡</p>
        
        <div class="test-section">
            <h3>ğŸ”§ ç¿»è¯‘æœåŠ¡æµ‹è¯•</h3>
            <button onclick="testTranslationService()">æµ‹è¯•ç¿»è¯‘æœåŠ¡</button>
            <button onclick="testLanguageDetection()">æµ‹è¯•è¯­è¨€æ£€æµ‹</button>
            <button onclick="testJapaneseTranslation()">æµ‹è¯•æ—¥è¯­ç¿»è¯‘</button>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            <div id="serviceTestResult"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“° æ–°é—»ç¿»è¯‘æµ‹è¯•</h3>
            <button onclick="testNewsTranslation()">æµ‹è¯•æ–°é—»ç¿»è¯‘</button>
            <div id="newsTestResult"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æ§åˆ¶å°æ—¥å¿—</h3>
            <div id="logContainer" class="log-container"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç¿»è¯‘æœåŠ¡
        class TranslationService {
            constructor() {
                this.cache = new Map()
            }

            needsTranslation(currentLang) {
                console.log(`ğŸ” æ£€æŸ¥æ˜¯å¦éœ€è¦ç¿»è¯‘: currentLang="${currentLang}"`)
                
                // å¦‚æœæ˜¯ä¸­æ–‡ç›¸å…³è¯­è¨€ï¼Œä¸éœ€è¦ç¿»è¯‘
                if (currentLang === 'CN' || currentLang === 'zh-CN' || currentLang === 'zh') {
                    console.log('âŒ ä¸­æ–‡è¯­è¨€ï¼Œä¸éœ€è¦ç¿»è¯‘')
                    return false
                }
                
                // å¦‚æœæ˜¯è‹±æ–‡æˆ–æ—¥æ–‡ï¼Œéœ€è¦ç¿»è¯‘
                const needsTranslation = currentLang === 'en' || currentLang === 'English' || 
                                        currentLang === 'Japanese' || currentLang === 'ja' || currentLang === 'jp'
                
                console.log(`${needsTranslation ? 'âœ…' : 'âŒ'} éœ€è¦ç¿»è¯‘: ${needsTranslation}`)
                return needsTranslation
            }

            translateTextSync(text, targetLang) {
                console.log(`ğŸ”„ translateTextSync è°ƒç”¨: targetLang="${targetLang}", text="${text?.substring(0, 50)}..."`)
                
                if (!text || !this.needsTranslation(targetLang)) {
                    console.log(`è·³è¿‡ç¿»è¯‘: text=${!!text}, needsTranslation=${this.needsTranslation(targetLang)}`)
                    return text
                }

                let result
                try {
                    console.log(`ğŸ¯ å¼€å§‹ç¿»è¯‘åˆ°ç›®æ ‡è¯­è¨€: ${targetLang}`)
                    
                    if (targetLang === 'en' || targetLang === 'English') {
                        console.log('ğŸ“ è°ƒç”¨è‹±æ–‡ç¿»è¯‘')
                        result = this.mockTranslateToEnglish(text)
                    } else if (targetLang === 'ja' || targetLang === 'Japanese' || targetLang === 'jp') {
                        console.log('ğŸ“ è°ƒç”¨æ—¥æ–‡ç¿»è¯‘')
                        result = this.mockTranslateToJapanese(text)
                    } else {
                        console.log('â“ æœªçŸ¥ç›®æ ‡è¯­è¨€ï¼Œè¿”å›åŸæ–‡')
                        result = text
                    }
                    
                    console.log(`ç¿»è¯‘ç»“æœ: "${result?.substring(0, 100)}..."`)
                    return result
                } catch (error) {
                    console.error('ç¿»è¯‘è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error)
                    return text
                }
            }

            mockTranslateToJapanese(text) {
                console.log('ğŸ‡¯ğŸ‡µ å¼€å§‹æ—¥æ–‡ç¿»è¯‘:', text.substring(0, 50) + '...')
                
                // ç®€åŒ–çš„æ—¥æ–‡ç¿»è¯‘é€»è¾‘
                const keywordMap = {
                    'ç¾è”å‚¨': 'FRB',
                    'ç¾å›½': 'ç±³å›½',
                    'è‚¡å¸‚': 'æ ªå¼å¸‚å ´',
                    'ä¸Šæ¶¨': 'ä¸Šæ˜‡',
                    'ä¸‹è·Œ': 'ä¸‹è½',
                    'é»„é‡‘': 'é‡‘',
                    'åŸæ²¹': 'åŸæ²¹',
                    'ç¾å…ƒ': 'ç±³ãƒ‰ãƒ«',
                    'æ¬§å…ƒ': 'ãƒ¦ãƒ¼ãƒ­',
                    'ä»Šæ—¥': 'æœ¬æ—¥',
                    'æŠ¥å‘Š': 'å ±å‘Š',
                    'æ•°æ®': 'ãƒ‡ãƒ¼ã‚¿',
                    'å¸‚åœº': 'å¸‚å ´',
                    'ç»æµ': 'çµŒæ¸ˆ',
                    'æ”¿ç­–': 'æ”¿ç­–',
                    'å®˜å‘˜': 'å½“å±€è€…',
                    'è¡¨ç¤º': 'è¡¨æ˜',
                    'å‘å¸ƒ': 'ç™ºè¡¨',
                    'å¢é•¿': 'æˆé•·',
                    'é€šèƒ€': 'ã‚¤ãƒ³ãƒ•ãƒ¬'
                }

                let result = text
                for (const [chinese, japanese] of Object.entries(keywordMap)) {
                    result = result.replace(new RegExp(chinese, 'g'), japanese)
                }

                // å¦‚æœç¿»è¯‘è¦†ç›–ç‡ä½ï¼Œä½¿ç”¨æ™ºèƒ½æ‘˜è¦
                const chineseCharCount = (result.match(/[\u4e00-\u9fa5]/g) || []).length
                const totalCharCount = result.length

                if (chineseCharCount / totalCharCount > 0.6) {
                    console.log('ä¸­æ–‡æ¯”ä¾‹è¿‡é«˜ï¼Œä½¿ç”¨æ™ºèƒ½æ—¥æ–‡æ‘˜è¦')
                    result = this.generateJapaneseSummary(text, result)
                }

                console.log('æ—¥æ–‡ç¿»è¯‘å®Œæˆ:', result.substring(0, 100) + '...')
                return result
            }

            generateJapaneseSummary(originalText, partialTranslation) {
                // ç®€åŒ–çš„æ™ºèƒ½æ‘˜è¦ç”Ÿæˆ
                if (originalText.includes('ç¾è”å‚¨') || originalText.includes('FRB')) {
                    return 'FRBã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼šæ”¿ç­–æ±ºå®šã¨çµŒæ¸ˆè¦‹é€šã—ã«é–¢ã™ã‚‹å£°æ˜'
                } else if (originalText.includes('è‚¡å¸‚') || originalText.includes('æŒ‡æ•°')) {
                    return 'ç±³å›½å¸‚å ´ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼šä¸»è¦æŒ‡æ•°ã¨çµŒæ¸ˆæŒ‡æ¨™ã®å‹•å‘'
                } else if (originalText.includes('é»„é‡‘') || originalText.includes('åŸæ²¹')) {
                    return 'å•†å“å¸‚å ´ãƒ¬ãƒãƒ¼ãƒˆï¼šé‡‘ã€åŸæ²¹ã€ãã®ä»–ä¸»è¦å•†å“ã®ä¾¡æ ¼å‹•å‘'
                } else if (originalText.includes('ç¾å…ƒ') || originalText.includes('æ±‡ç‡')) {
                    return 'å¤–å›½ç‚ºæ›¿å¸‚å ´ãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼šé€šè²¨ã®å‹•ãã¨ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã®å±•é–‹'
                } else {
                    const timestamp = new Date().getTime().toString().slice(-4)
                    return `é‡‘èãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼šå¸‚å ´ã®å‹•å‘ã¨çµŒæ¸ˆåˆ†æ (${timestamp})`
                }
            }

            mockTranslateToEnglish(text) {
                // ç®€åŒ–çš„è‹±æ–‡ç¿»è¯‘ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
                return "Financial news: Market updates and economic developments"
            }
        }

        // åˆ›å»ºç¿»è¯‘æœåŠ¡å®ä¾‹
        const translationService = new TranslationService()

        // æµ‹è¯•æ•°æ®
        const testNewsData = [
            {
                uuid: '1',
                description: 'ç¾è”å‚¨å®˜å‘˜è¡¨ç¤ºï¼Œå½“å‰é€šèƒ€æ°´å¹³ä»ç„¶æ˜¯è´§å¸æ”¿ç­–çš„ä¸»è¦è€ƒè™‘å› ç´ ï¼Œå¤®è¡Œå°†ç»§ç»­å¯†åˆ‡å…³æ³¨ç»æµæ•°æ®å˜åŒ–ã€‚'
            },
            {
                uuid: '2', 
                description: 'é“æŒ‡æœŸæŒ‡æ”¶æ¶¨22æ—¥ï¼ˆå‘¨ä¸€ï¼‰æ”¶ç›˜ä¸Šæ¶¨6.27ç‚¹ï¼Œæ¶¨å¹…0.14%ï¼ŒæŠ¥46381.54ç‚¹ï¼›æ ‡æ™®500æœŸæŒ‡æ”¶æ¶¨22æ—¥ï¼ˆå‘¨ä¸€ï¼‰æ”¶ç›˜ä¸Šæ¶¨29.39ç‚¹ã€‚'
            },
            {
                uuid: '3',
                description: 'é»„é‡‘ä»·æ ¼ä»Šæ—¥åˆ›ä¸‹æ–°é«˜ï¼Œæ¯ç›å¸çªç ´2000ç¾å…ƒå¤§å…³ï¼Œä¸»è¦å—åˆ°é¿é™©éœ€æ±‚æ¨åŠ¨å’Œç¾å…ƒèµ°å¼±å½±å“ã€‚'
            },
            {
                uuid: '4',
                description: 'ç¾å…ƒå…‘ä¸»è¦è´§å¸æ±‡ç‡ä»Šæ—¥æ™®éä¸‹è·Œï¼Œç¾å…ƒæŒ‡æ•°è·Œè‡³102.5ï¼Œæ¬§å…ƒå…‘ç¾å…ƒä¸Šæ¶¨è‡³1.0950ã€‚'
            },
            {
                uuid: '5',
                description: 'ä¸­å›½å‘å¸ƒæœ€æ–°CPIæ•°æ®ï¼Œ9æœˆä»½æ¶ˆè´¹è€…ä»·æ ¼æŒ‡æ•°åŒæ¯”ä¸Šæ¶¨2.1%ï¼Œç¬¦åˆå¸‚åœºé¢„æœŸï¼Œæ˜¾ç¤ºé€šèƒ€å‹åŠ›æ¸©å’Œã€‚'
            }
        ]

        // æ—¥å¿—è®°å½•
        function logToContainer(message, type = 'info') {
            const logContainer = document.getElementById('logContainer')
            const timestamp = new Date().toLocaleTimeString()
            const logEntry = document.createElement('div')
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`
            logContainer.appendChild(logEntry)
            logContainer.scrollTop = logContainer.scrollHeight
        }

        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalConsoleLog = console.log
        const originalConsoleError = console.error
        const originalConsoleWarn = console.warn

        console.log = function(...args) {
            originalConsoleLog.apply(console, args)
            logToContainer(args.join(' '), 'info')
        }

        console.error = function(...args) {
            originalConsoleError.apply(console, args)
            logToContainer('âŒ ' + args.join(' '), 'error')
        }

        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args)
            logToContainer('âš ï¸ ' + args.join(' '), 'warning')
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = ''
        }

        function showStatus(message, type) {
            const statusDiv = document.createElement('div')
            statusDiv.className = `status ${type}`
            statusDiv.textContent = message
            return statusDiv
        }

        function testTranslationService() {
            const resultDiv = document.getElementById('serviceTestResult')
            resultDiv.innerHTML = '<h4>ç¿»è¯‘æœåŠ¡æµ‹è¯•ç»“æœ</h4>'

            console.log('=== å¼€å§‹ç¿»è¯‘æœåŠ¡æµ‹è¯• ===')

            // æµ‹è¯•è¯­è¨€æ£€æµ‹
            const languages = ['zh-CN', 'en', 'ja', 'Japanese', 'jp', 'unknown']
            languages.forEach(lang => {
                const needsTranslation = translationService.needsTranslation(lang)
                console.log(`è¯­è¨€ "${lang}" éœ€è¦ç¿»è¯‘: ${needsTranslation}`)
            })

            resultDiv.appendChild(showStatus('ç¿»è¯‘æœåŠ¡æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—', 'success'))
        }

        function testLanguageDetection() {
            console.log('=== å¼€å§‹è¯­è¨€æ£€æµ‹æµ‹è¯• ===')
            
            const testCases = [
                { lang: 'ja', expected: true },
                { lang: 'Japanese', expected: true },
                { lang: 'jp', expected: true },
                { lang: 'zh-CN', expected: false },
                { lang: 'zh', expected: false },
                { lang: 'en', expected: true }
            ]

            testCases.forEach(testCase => {
                const result = translationService.needsTranslation(testCase.lang)
                const status = result === testCase.expected ? 'âœ…' : 'âŒ'
                console.log(`${status} è¯­è¨€ "${testCase.lang}": æœŸæœ› ${testCase.expected}, å®é™… ${result}`)
            })
        }

        function testJapaneseTranslation() {
            console.log('=== å¼€å§‹æ—¥è¯­ç¿»è¯‘æµ‹è¯• ===')
            
            const testTexts = [
                'ç¾è”å‚¨å®˜å‘˜è¡¨ç¤ºé€šèƒ€ä»æ˜¯ä¸»è¦å…³æ³¨ç‚¹',
                'é“æŒ‡æœŸæŒ‡æ”¶æ¶¨ï¼Œæ ‡æ™®500ä¸Šæ¶¨',
                'é»„é‡‘ä»·æ ¼åˆ›æ–°é«˜ï¼Œé¿é™©éœ€æ±‚æ¨åŠ¨',
                'ç¾å…ƒæŒ‡æ•°ä¸‹è·Œï¼Œæ¬§å…ƒèµ°å¼º'
            ]

            testTexts.forEach((text, index) => {
                console.log(`--- æµ‹è¯• ${index + 1}: ${text} ---`)
                const result = translationService.translateTextSync(text, 'ja')
                console.log(`ç¿»è¯‘ç»“æœ: ${result}`)
            })
        }

        function testNewsTranslation() {
            const resultDiv = document.getElementById('newsTestResult')
            resultDiv.innerHTML = '<h4>æ–°é—»ç¿»è¯‘æµ‹è¯•ç»“æœ</h4>'

            console.log('=== å¼€å§‹æ–°é—»ç¿»è¯‘æµ‹è¯• ===')

            testNewsData.forEach((news, index) => {
                console.log(`--- ç¿»è¯‘æ–°é—» ${index + 1} ---`)
                console.log(`åŸæ–‡: ${news.description}`)
                
                const japaneseResult = translationService.translateTextSync(news.description, 'ja')
                console.log(`æ—¥æ–‡: ${japaneseResult}`)

                // æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
                const newsDiv = document.createElement('div')
                newsDiv.innerHTML = `
                    <div class="original-text"><strong>åŸæ–‡:</strong> ${news.description}</div>
                    <div class="translated-text"><strong>æ—¥æ–‡:</strong> ${japaneseResult}</div>
                `
                resultDiv.appendChild(newsDiv)
            })

            resultDiv.appendChild(showStatus('æ–°é—»ç¿»è¯‘æµ‹è¯•å®Œæˆ', 'success'))
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            console.log('ğŸš€ æ—¥è¯­ç¿»è¯‘æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ')
            console.log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½')
        }
    </script>
</body>
</html>
